var closetimer=0,ddmenuitem=0,homemenuloaded=0;function mopen(a,b){"homemenu"==a&&0==homemenuloaded&&(basicahah(imasroot+"/gethomemenu.php?cid="+b,"homemenu"),homemenuloaded=1);mcancelclosetime();ddmenuitem?(ddmenuitem.style.visibility="hidden",ddmenuitem=null):(ddmenuitem=document.getElementById(a),ddmenuitem.style.visibility="visible")}function mclose(){ddmenuitem&&(ddmenuitem.style.visibility="hidden",ddmenuitem=null)}function mclosetime(){closetimer=window.setTimeout(mclose,250)}
function mcancelclosetime(){closetimer&&(window.clearTimeout(closetimer),closetimer=null)}function basicahah(a,b,c){null==c&&(c=" Fetching data... ");document.getElementById(b).innerHTML=c;c=!1;window.XMLHttpRequest?(req=new XMLHttpRequest,c=!0):window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP"),c=!0);c&&(req.onreadystatechange=function(){basicahahDone(a,b)},req.open("GET",a,!0),req.send(""))}
function basicahahDone(a,b){4==req.readyState&&(200==req.status?document.getElementById(b).innerHTML=req.responseText:document.getElementById(b).innerHTML=" AHAH Error:\n"+req.status+"\n"+req.statusText)}function arraysearch(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return c;return-1}var tipobj=0,curtipel=null;
function tipshow(a,b,c){if("undefined"!=typeof c&&"touchstart"==c.type){if(curtipel==a)return tipout(),!1;jQuery(document).on("touchstart.tipshow",function(){tipout(a)})}curtipel!=a&&("object"!=typeof tipobj&&(tipobj=document.createElement("div"),tipobj.className="tips",tipobj.setAttribute("role","tooltip"),tipobj.id="hovertipsholder",document.getElementsByTagName("body")[0].appendChild(tipobj)),curtipel=a,a.hasAttribute("data-tip")?tipobj.innerHTML=a.getAttribute("data-tip"):tipobj.innerHTML=b,tipobj.style.left=
"5px",$(tipobj).stop(!0,!0).fadeIn(100),tipobj.setAttribute("aria-hidden","false"),a.setAttribute("aria-describedby","hovertipsholder"),"undefined"!=typeof usingASCIIMath&&"undefined"!=typeof noMathRender&&usingASCIIMath&&!noMathRender&&-1!=tipobj.innerHTML.indexOf("`")&&rendermathnode(tipobj),b=findPos(a),self.innerHeight?x=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?x=document.documentElement.clientWidth:document.body&&(x=document.body.clientWidth),c=0,"number"==
typeof window.pageYOffset?c=window.pageXOffset:document.body&&(document.body.scrollLeft||document.body.scrollTop)?c=document.body.scrollLeft:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(c=document.documentElement.scrollLeft),x+=c,b[0]+tipobj.offsetWidth>x-10?(b[0]=x-tipobj.offsetWidth-30,$(tipobj).addClass("tipright")):$(tipobj).removeClass("tipright"),tipobj.style.left=b[0]+15+"px",tipobj.style.top=30>b[1]?b[1]+20+"px":b[1]-tipobj.offsetHeight+
"px")}function tipout(a){jQuery(document).off("touchstart.tipshow");$(tipobj).fadeOut(100);tipobj.setAttribute("aria-hidden","true");curtipel&&curtipel.removeAttribute("aria-describedby");curtipel=null}var popupwins=[];
function popupwindow(a,b,c,d,e){"fit"==d&&(d=window.height-80);c="width="+c+",height="+d+",status=0,resizable=1,directories=0,menubar=0";null!=e&&1==e&&(c+=",scrollbars=1");"undefined"==typeof popupwins[a]||popupwins[a].closed||popupwins[a].focus();b.match(/^http/)?popupwins[a]=window.open(b,a,c):(e=window.open("",a,c),e.document.write("<html><head><title>Popup</title></head><body>"),e.document.write(b),e.document.write("</body></html>"),e.document.close(),popupwins[a]=e)}
function findPos(a){var b=curtop=0;if(a.offsetParent){do b+=a.offsetLeft,curtop+=a.offsetTop,a.offsetParent&&(a.parentNode&&a.offsetParent!=a.parentNode?(b-=a.parentNode.scrollLeft,curtop-=a.parentNode.scrollTop):(b-=a.offsetParent.scrollLeft,curtop-=a.offsetParent.scrollTop));while(a=a.offsetParent)}return[b,curtop]}
function togglepic(a){a.getAttribute("src").match("userimg_sm")?a.setAttribute("src",a.getAttribute("src").replace("_sm","_")):a.setAttribute("src",a.getAttribute("src").replace("_","_sm"))}function addLoadEvent(a){var b=window.onload;window.onload="function"!=typeof window.onload?a:function(){b&&b();a()}}
function submitlimiter(a){var b=a.target;if("submitted"==b.className)return alert("You have already submitted this page.  Please be patient while your submission is processed."),b.className="submitted2",a.preventDefault?a.preventDefault():a.returnValue=!1,!1;if("submitted2"==b.className)return a.preventDefault?a.preventDefault():a.returnValue=!1,!1;b.className="submitted";return!0}
function setupFormLimiters(){for(var a=document.getElementsByTagName("form"),b=0;b<a.length;b++)if("function"!=typeof a[b].onsubmit&&"nolimit"!=a[b].className&&"limitaftervalidate"!=a[b].className)$(a[b]).on("submit",submitlimiter)}addLoadEvent(setupFormLimiters);var GB_loaded=!1;
function GB_show(a,b,c,d){if(0==GB_loaded){var e=document.createElement("div");e.id="GB_overlay";e.onclick=GB_hide;document.getElementsByTagName("body")[0].appendChild(e);e=document.createElement("div");e.setAttribute("role","dialog");e.setAttribute("aria-labelledby","GB_title");e.setAttribute("tabindex",-1);e.id="GB_window";e.innerHTML='<div id="GB_caption"></div><div id="GB_loading">Loading...</div><div id="GB_frameholder" ></div>';document.getElementsByTagName("body")[0].appendChild(e);GB_loaded=
!0}document.getElementById("GB_frameholder").innerHTML='<iframe onload="GB_doneload()" id="GB_frame" src="'+b+'" title="'+a+'"></iframe>';jQuery("#GB_frameholder").isolatedScroll();b.match(/libtree/)?(document.getElementById("GB_caption").innerHTML='<span class="floatright"><input type="button" value="Use Libraries" onClick="document.getElementById(\'GB_frame\').contentWindow.setlib()" /> <a href="#" class="pointer" onclick="GB_hide();return false;" aria-label="Close">[X]</a>&nbsp;</span><span id="GB_title">Select Libraries</span><div class="clear"></div>',
a=self.innerHeight||de&&de.clientHeight||document.body.clientHeight):(document.getElementById("GB_caption").innerHTML='<span class="floatright"><a href="#" class="pointer" onclick="GB_hide();return false;" aria-label="Close">[X]</a></span><span id="GB_title">'+a+"</span>",document.getElementById("GB_caption").onclick=GB_hide,a="auto"==d?self.innerHeight||de&&de.clientHeight||document.body.clientHeight:d);document.getElementById("GB_window").style.display="block";document.getElementById("GB_overlay").style.display=
"block";document.getElementById("GB_loading").style.display="block";b=$(document).width();c>b-20&&(c=b-20);document.getElementById("GB_window").style.width=c+"px";document.getElementById("GB_window").style.height=a-30+"px";document.getElementById("GB_frame").style.height=a-30-36+"px";document.getElementById("GB_window").focus();$(document).on("keydown.GB",function(a){27==a.keyCode&&GB_hide()})}function GB_doneload(){document.getElementById("GB_loading").style.display="none"}
function GB_hide(){document.getElementById("GB_window").style.display="none";document.getElementById("GB_overlay").style.display="none";$(document).off("keydown.GB")}function chkAllNone(a,b,c,d){a=document.getElementById(a);for(i=0;i<=a.elements.length;i++)try{if("all"==b&&"checkbox"==a.elements[i].type||a.elements[i].name==b)a.elements[i].checked=d&&a.elements[i].className==d?!c:c}catch(e){}return!1}var tinyMCEPreInit={base:imasroot+"/tinymce4"};
function initeditor(a,b,c,d,e){c=c||0;d=d||0;var f="";"exact"==a?f="#"+b.split(/,/).join(",#"):"textareas"==a?f="textarea."+b:"divs"==a?f="div."+b:"selector"==a&&(f=b);a={selector:f,inline:d,plugins:["lists advlist autolink attach image charmap anchor","searchreplace code link textcolor snippet","media table paste asciimath asciisvg rollups colorpicker"],menubar:!1,toolbar1:"myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor backcolor | snippet code | saveclose",
toolbar2:" alignleft aligncenter alignright | bullist numlist outdent indent  | attach link unlink image | table | asciimath asciimathcharmap asciisvg",extended_valid_elements:"iframe[src|width|height|name|align|allowfullscreen|frameborder],param[name|value],@[sscr]",content_css:imasroot+(1==c?"/assessment/mathtest.css,":"/imascore.css,")+imasroot+"/themes/"+coursetheme,AScgiloc:imasroot+"/filter/graph/svgimg.php",convert_urls:!1,file_picker_callback:filePickerCallBackFunc,file_picker_types:"file image",
images_upload_url:imasroot+"/tinymce4/upload_handler.php",paste_data_images:!0,default_link_target:"_blank",browser_spellcheck:!0,branding:!1,resize:"both",width:"100%",content_style:"body {background-color: #ffffff !important;}",table_class_list:[{title:"None",value:""},{title:"Gridded",value:"gridded"},{title:"Gridded Centered",value:"gridded centered"}],style_formats_merge:!0,snippets:1==tinymceUseSnippets?imasroot+"/tinymce4/getsnippets.php":!1,style_formats:[{title:"Font Family",items:[{title:"Arial",
inline:"span",styles:{"font-family":"arial"}},{title:"Book Antiqua",inline:"span",styles:{"font-family":"book antiqua"}},{title:"Comic Sans MS",inline:"span",styles:{"font-family":"comic sans ms,sans-serif"}},{title:"Courier New",inline:"span",styles:{"font-family":"courier new,courier"}},{title:"Georgia",inline:"span",styles:{"font-family":"georgia,palatino"}},{title:"Helvetica",inline:"span",styles:{"font-family":"helvetica"}},{title:"Impact",inline:"span",styles:{"font-family":"impact,chicago"}},
{title:"Open Sans",inline:"span",styles:{"font-family":"Open Sans"}},{title:"Symbol",inline:"span",styles:{"font-family":"symbol"}},{title:"Tahoma",inline:"span",styles:{"font-family":"tahoma"}},{title:"Terminal",inline:"span",styles:{"font-family":"terminal,monaco"}},{title:"Times New Roman",inline:"span",styles:{"font-family":"times new roman,times"}},{title:"Verdana",inline:"span",styles:{"font-family":"Verdana"}}]},{title:"Font Size",items:[{title:"x-small",inline:"span",styles:{fontSize:"x-small",
"font-size":"x-small"}},{title:"small",inline:"span",styles:{fontSize:"small","font-size":"small"}},{title:"medium",inline:"span",styles:{fontSize:"medium","font-size":"medium"}},{title:"large",inline:"span",styles:{fontSize:"large","font-size":"large"}},{title:"x-large",inline:"span",styles:{fontSize:"x-large","font-size":"x-large"}},{title:"xx-large",inline:"span",styles:{fontSize:"xx-large","font-size":"xx-large"}}]}]};385>document.documentElement.clientWidth?(a.toolbar1="myEdit myInsert styleselect | bold italic underline | saveclose",
a.toolbar2="bullist numlist outdent indent  | link image | asciimath asciisvg"):465>document.documentElement.clientWidth?(a.toolbar1="myEdit myInsert styleselect | bold italic underline forecolor | saveclose",a.toolbar2="bullist numlist outdent indent  | link unlink image | asciimath asciisvg"):575>document.documentElement.clientWidth&&(a.toolbar1="myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor | saveclose",a.toolbar2=" alignleft aligncenter | bullist numlist outdent indent  | link unlink image | asciimath asciimathcharmap asciisvg");
e&&(a.setup=e);tinymce.remove();tinymce.init(a)}function filePickerCallBack(a,b,c){b=imasroot+"/tinymce4/file_manager.php";switch(c.filetype){case "image":b+="?type=img";break;case "file":b+="?type=files"}tinyMCE.activeEditor.windowManager.open({file:b,title:"File Manager",width:350,height:450,resizable:"yes",inline:"yes",close_previous:"no"},{oninsert:function(b,c){a(b)}})}
function imascleanup(a,b){"get_from_editor"==a&&(b=b.replace(/\x3c!--([\s\S]*?)--\x3e|&lt;!--([\s\S]*?)--&gt;|<style>[\s\S]*?<\/style>/g,""),b=b.replace(/class="?Mso\w+"?/g,""),b=b.replace(/<p\s*>\s*<\/p>/gi,""),b=b.replace(/<script.*?\/script>/gi,""),b=b.replace(/<input[^>]*button[^>]*>/gi,""));return b}
function readCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return unescape(d.substring(a.length,d.length))}return null}
function selectByDivID(a){var b=a.value;a=a.value.split(":")[0];for(var c=document.getElementsByTagName("div"),d=0;d<c.length;d++)c[d].className.match(a)&&(c[d].style.display=c[d].id==b?"block":"none");c=new Date;c.setDate(c.getDate()+365);document.cookie=a+"store="+escape(b)+";expires="+c.toGMTString()}
function setselectbycookie(){for(var a=document.getElementsByTagName("select"),b=0;b<a.length;b++)if(a[b].className.match("alts")){var c=a[b].className.replace(/alts/,"").replace(/\s/g,"");null!=(co=readCookie(c+"store"))&&(co=co.replace("store",""),a[b].value=co,selectByDivID(a[b]))}}addLoadEvent(setselectbycookie);var recordedunload=!1;
function recclick(a,b,c,d){if(0<cid){var e="",f;null!==(f=window.location.href.match(/showlinkedtext.*?&id=(\d+)/))&&0==recordedunload&&(e="&unloadinglinked="+f[1],recordedunload=!0);jQuery.ajax({type:"POST",url:imasroot+"/course/rectrack.php?cid="+cid,data:"type="+encodeURIComponent(a)+"&typeid="+encodeURIComponent(b)+"&info="+encodeURIComponent(c+"::"+d)+e})}}
function setuptracklinks(a,b){jQuery(b).attr("data-base")&&jQuery(b).click(function(a){var c=jQuery(this).attr("data-base").split("-");recclick(c[0],c[1],jQuery(this).attr("href"),jQuery(this).text());if("undefined"==typeof jQuery(b).attr("target"))return a.preventDefault(),setTimeout('window.location.href = "'+jQuery(this).attr("href")+'"',100),!1}).mousedown(function(a){3==a.which&&(a=jQuery(this).attr("data-base").split("-"),recclick(a[0],a[1],jQuery(this).attr("href"),jQuery(this).text()))})}
var videoembedcounter=0;
function togglevideoembed(){var a=this.id.substr(13),b=jQuery("#videoiframe"+a);if(0<b.length)"none"==b.css("display")?(b.show(),b.parent(".fluid-width-video-wrapper").show(),jQuery(this).text(" [-]"),jQuery(this).attr("title",_("Hide video")),jQuery(this).attr("aria-label",_("Hide embedded video"))):(b.hide(),b.get(0).contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),b.parent(".fluid-width-video-wrapper").hide(),jQuery(this).text(" [+]"),jQuery(this).attr("title",_("Watch video here")),
jQuery(this).attr("aria-label",_("Embed video here")));else{b=jQuery(this).prev().attr("href");var c="?";if(b.match(/youtube\.com/))if(-1<b.indexOf("playlist?list=")){var d=b.split("list=")[1].split(/[#&]/)[0],e="www.youtube.com/embed/videoseries?list=";c="&"}else d=b.match(/\/embed\//)?b.split("/embed/")[1].split(/[#&\?]/)[0]:b.split("v=")[1].split(/[#&]/)[0],e="www.youtube.com/embed/";else b.match(/youtu\.be/)?(d=b.split(".be/")[1].split(/[#&]/)[0],e="www.youtube.com/embed/"):b.match(/vimeo/)&&
(d=b.split(".com/")[1].split(/[#&]/)[0],e="player.vimeo.com/video/");var f=b.match(/.*\Wt=((\d+)m)?((\d+)s)?.*/);null==f?(c+="rel=0",f=b.match(/.*start=(\d+)/),null!=f&&(c+="&start="+f[1])):c=c+"rel=0&start="+((f[2]?60*f[2]:0)+(f[4]?1*f[4]:0));f=b.match(/.*end=(\d+)/);null!=f&&(c+="&end="+f[1]);jQuery("<iframe/>",{id:"videoiframe"+a,width:640,height:400,src:("https:"==location.protocol?"https:":"http:")+"//"+e+d+(c+"&enablejsapi=1"),frameborder:0,allowfullscreen:1}).insertAfter(jQuery(this));jQuery(this).parent().fitVids();
jQuery("<br/>").insertAfter(jQuery(this));jQuery(this).text(" [-]");jQuery(this).attr("title",_("Hide video"));jQuery(this).prev().attr("data-base")&&(a=jQuery(this).prev().attr("data-base").split("-"),recclick(a[0],a[1],b,jQuery(this).prev().text()))}}
function setupvideoembeds(a,b){jQuery("<span/>",{text:" [+]",role:"button",title:_("Watch video here"),"aria-label":_("Embed video here"),id:"videoembedbtn"+videoembedcounter,click:togglevideoembed,keydown:function(a){13==a.which&&$(this).click()},tabindex:0,"class":"videoembedbtn"}).insertAfter(b);videoembedcounter++}function addNoopener(a,b){!b.rel&&b.target&&b.host!==window.location.host&&b.setAttribute("rel","noopener noreferrer")}
function addBlankTarget(a,b){b.host!==window.location.host&&b.setAttribute("target","_blank")}function addmultiselect(a,b){var c=jQuery(a).parent(),d=jQuery("#"+b).val(),e=jQuery("#"+b+" option[value="+d+"]").prop("disabled",!0).html();"null"!=d&&c.append('<div class="multiselitem"><span class="right"><a href="#" onclick="removemultiselect(this);return false;">Remove</a></span><input type="hidden" name="'+b+'[]" value="'+d+'"/>'+e+"</div>");jQuery("#"+b).val("null")}
function removemultiselect(a){a=jQuery(a).parent().parent();var b=a.find("input").val();a.parent().find("option[value="+b+"]").prop("disabled",!1);a.remove()}function hidefromcourselist(a,b,c){confirm("Are you SURE you want to hide this course from your course list?")&&jQuery.ajax({type:"GET",url:imasroot+"/admin/hidefromcourselist.php?tohide="+b+"&type="+c}).done(function(b){"OK"==b&&(jQuery(a).closest("ul.courselist > li").slideUp(),jQuery("#unhidelink"+c).show())});return!1}
function removeSelfAsCoteacher(a,b,c,d){c=c||"ul.courselist > li";d=d||null;confirm("Are you SURE you want to remove yourself as a co-teacher on this course?")&&jQuery.ajax({type:"POST",url:imasroot+"/admin/actions.php",data:{action:"removeself",id:b,uid:d}}).done(function(b){"OK"==b&&jQuery(a).closest(c).slideUp()});return!1}
function rotateimg(a){var b=$(a).data("rotation")?($(a).data("rotation")+90)%360:90;$(a).data("rotation",b).css({transform:"rotate("+b+"deg)"});90==b%180?(b=($(a).width()-$(a).height())/2,0<b&&$(a).parent().css({"padding-top":b,"padding-bottom":b})):$(a).parent().css({"padding-top":0,"padding-bottom":0})}
function sendLTIresizemsg(){var a=Math.max(document.body.scrollHeight,document.body.offsetHeight)+100;window.parent!=window.self&&parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:a}),"*")}
jQuery(document).ready(function(a){a(window).on("message",function(b){if("string"==typeof b.originalEvent.data&&b.originalEvent.data.match(/lti\.frameResize/)){var c=JSON.parse(b.originalEvent.data);if("frame_id"in c)a("#"+c.frame_id).height(c.height);else if("iframe_resize_id"in c)a("#"+c.iframe_resize_id).height(c.height);else for(var d=document.getElementsByTagName("iframe"),e=0;e<d.length;e++)if(d[e].contentWindow===b.originalEvent.source){a(d[e]).height(c.height);break}}else"string"==typeof b.originalEvent.data&&
b.originalEvent.data.match(/\[iFrameSizer\]/)?(c=b.originalEvent.data.substr(13).split(":"),a("#"+c[0]).height(c[1])):"string"==typeof b.originalEvent.data&&b.originalEvent.data.match(/imathas\.update/)&&(c=JSON.parse(b.originalEvent.data),"qn"in c?(b=c.qn.replace(/[^\d]/,""),""!=b&&a("#qn"+b).val(c.value)):(b=c.id.replace(/[^\w\-]/,""),a("#"+b).hasClass("allowupdate")&&a("#"+b).val(c.value)))})});
jQuery(document).ready(function(a){"undefined"!=typeof isImathasAssessment&&a("a:not([target])").each(addBlankTarget);a("a").each(setuptracklinks).each(addNoopener);a('a[href*="youtu"]').each(setupvideoembeds);a('a[href*="vimeo"]').each(setupvideoembeds);a("body").fitVids()});
jQuery.fn.isolatedScroll=function(){this.bind("mousewheel DOMMouseScroll",function(a){var b=a.wheelDelta||a.originalEvent&&a.originalEvent.wheelDelta||-a.detail,c=0<=this.scrollTop+jQuery(this).outerHeight()-this.scrollHeight,d=0>=this.scrollTop;(0>b&&c||0<b&&d)&&a.preventDefault()});return this};
jQuery(document).ready(function(a){for(var b=a(".fixedonscroll"),c=[],d=0;d<b.length;d++)c[d]=a(b[d]).offset().top,a(b[d]).height()>a(window).height()&&(c[d]=-1);0<b.length&&"left"==a(b[0]).css("float")&&a(window).scroll(function(){for(var d=a(window).scrollTop(),f=0;f<b.length;f++)d>c[f]&&0<c[f]?a(b[f]).css("position","fixed").css("top","5px"):a(b[f]).css("position","static")})});
function _(a){var b="undefined"!=typeof i18njs&&i18njs[a]?i18njs[a]:a;if(1<arguments.length)for(var c=1;c<arguments.length;c++)b=b.replace("$"+c,arguments[c]);return b}function randID(){return"_"+Math.random().toString(36).substr(2,9)}
jQuery(document).ready(function(a){a(".grouptoggle").each(function(){var b=randID();a(this).next(".blockitems").hide().removeClass("hidden").attr("id","bi"+b);a(this).attr("id",b).attr("aria-controls","bi"+b).attr("aria-expanded",!1).attr("tabindex",0).css("cursor","pointer").on("click keydown",function(b){if("click"==b.type||13==b.which)"true"==a(this).attr("aria-expanded")?(a(this).attr("aria-expanded",!1),a(this).children("img").attr("src","../img/expand.gif"),a(this).next(".blockitems").slideUp()):
(a(this).attr("aria-expanded",!0),a(this).children("img").attr("src","../img/collapse.gif"),a(this).next(".blockitems").slideDown())})});a(".grouptoggle img").attr("alt","expand/collapse")});
(function(a){a.fn.fitVids=function(){return this.each(function(){a(this).find("iframe[src*='player.vimeo.com'],iframe[src*='youtube.com'],iframe[src*='youtube-nocookie.com']").each(function(){var b=a(this);if(0<b.closest(".textsegment").length)return!0;b.parentsUntil(".intro","table").each(function(){a(this).css("width","100%")});var c=b.attr("height")&&!isNaN(parseInt(b.attr("height"),10))?parseInt(b.attr("height"),10):b.height(),d=isNaN(parseInt(b.attr("width"),10))?b.width():parseInt(b.attr("width"),
10);c/=d;b.attr("id")||b.attr("id","fitvid"+Math.floor(999999*Math.random()));b.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*c+"%").wrap('<div class="video-wrapper-wrapper"></div>').parent(".video-wrapper-wrapper").css("max-width",d+"px");b.removeAttr("height").removeAttr("width").css("height","").css("width","")})})}})(window.jQuery||window.Zepto);
function setAltSelectors(a,b){$(".alts."+a).parents(".altWrap").find(".altContentOn").removeClass("altContentOn").addClass("altContentOff");$(".alts."+a).parents(".altWrap").find("."+b).addClass("altContentOn").removeClass("altContentOff");$("select.alts."+a).val(a+":"+b);var c=new Date;c.setDate(c.getDate()+365);document.cookie="alt_store_"+a+"="+escape(b)+";expires="+c.toGMTString()+";path=/"}
jQuery(document).ready(function(a){a(".alts").on("change",function(){var a=this.value.split(":");1<a.length&&setAltSelectors(a[0],a[1])}).each(function(b,c){var d=c.value.split(":");null!=(co=readCookie("alt_store_"+d[0]))?setAltSelectors(d[0],co):a(c).hasClass("setDefault")&&setAltSelectors(d[0],d[1])});a(document).on("keydown",function(b){8!==b.which||a(b.target).is("input[type='text']:not([readonly]),input[type='number']:not([readonly]),input:not([type]):not([readonly]),input[type='password']:not([readonly]), textarea, [contenteditable='true']")||
b.preventDefault()});a("div.breadcrumb").attr("role","navigation").attr("aria-label",_("Navigation breadcrumbs"));a("div.cpmid,div.cp").attr("role","group").attr("aria-label",_("Control link group"));a("#centercontent").length&&(a("#centercontent").attr("role","main"),a(".midwrapper").removeAttr("role"))});
jQuery(document).ready(function(a){function b(b){var c=a("#headermobilemenulist");"true"==c.attr("aria-hidden")?(a("#headermobilemenulist").slideDown(50,function(){a("#headermobilemenulist").addClass("menuexpanded").removeAttr("style");c.attr("aria-hidden",!1);a("#topnavmenu").attr("aria-expanded",!0)}),a("#navlist").slideDown(100,function(){a("#navlist").addClass("menuexpanded").removeAttr("style")})):(a("#navlist").slideUp(100,function(){a("#navlist").removeClass("menuexpanded").removeAttr("style")}),
a("#headermobilemenulist").slideUp(50,function(){a("#headermobilemenulist").removeClass("menuexpanded").removeAttr("style");c.attr("aria-hidden",!0);a("#topnavmenu").attr("aria-expanded",!1)}));b.preventDefault()}a("#topnavmenu").on("click",b).on("keydown",function(a){13!==a.which&&32!=a.which||b(a)})});var sagecellcounter=0;
function initSageCell(a){jQuery(a).find(".converttosagecell").each(function(){var a=jQuery(this);if(a.is("pre")){var c=this;var d=jQuery(c).html().replace(/<br\s*\/?>/g,"\n").replace(/<\/?[a-zA-Z][^>]*>/g,"")}else if(c=a.find("textarea"),0==c.length||""==jQuery(c[0]).val())if(0<a.find("pre").length)d=a.find("pre").html().replace(/<br\s*\/?>/g,"\n").replace(/<\/?[a-zA-Z][^>]*>/g,"").replace(/\n\n/g,"\n"),c=0==c.length?a.find("pre")[0]:c[0];else return!1;else d=jQuery(c[0]).val(),c=c[0];if(m=d.match(/^\s+/)){a=
m[0].length;var e=new RegExp("\\n\\s{"+a+"}","g");d=d.substr(a).replace(e,"\n").replace(/\s+$/,"")}a="sagecell-"+sagecellcounter;sagecellcounter++;e=imasroot+"/assessment/libs/sagecellframe.html?frame_id="+a;e+="&code="+encodeURIComponent(d);"undefined"!=typeof jQuery(c).attr("id")&&(e+="&update_id="+jQuery(c).attr("id"));jQuery(c).addClass("allowupdate").hide().after(jQuery("<iframe/>",{id:a,"class":"sagecellframe",style:"border:0",width:"100%",height:100,src:e}))})}jQuery(function(){initSageCell("body")});
function setActiveTab(a){var b=a.id;jQuery(a).closest(".tabwrap").find("li.active").removeClass("active");jQuery(a).closest(".tablist").find("a[role=tab]").attr("aria-selected",!1);jQuery(a).attr("aria-selected",!0);jQuery(a).parent().addClass("active");jQuery(a).closest(".tabwrap").find(".tabpanel").hide().attr("aria-hidden",!0);b=b.replace(/tab/,"tabpanel");jQuery(a).closest(".tabwrap").find("#"+b).show().attr("aria-hidden",!1)}
+function(a){function b(b){var c=b.attr("data-target");c||(c=(c=b.attr("href"))&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));return(c=c&&a(c))&&c.length?c:b.parent()}function c(c){c&&3===c.which||(a(".dropdown-backdrop").remove(),a('[data-toggle="dropdown"]').each(function(){var d=a(this),f=b(d),e={relatedTarget:this};!f.hasClass("open")||c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(f[0],c.target)||(f.trigger(c=a.Event("hide.bs.dropdown",e)),c.isDefaultPrevented()||
(d.attr("aria-expanded","false"),f.removeClass("open").trigger("hidden.bs.dropdown",e)))}))}var d=function(b){a(b).on("click.bs.dropdown",this.toggle)};d.VERSION="3.3.5";d.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e);d=f.hasClass("open");c();if(!d){if("ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length)a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var g={relatedTarget:this};f.trigger(d=
a.Event("show.bs.dropdown",g));if(d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true");f.toggleClass("open").trigger("shown.bs.dropdown",g)}return!1}};d.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);c.preventDefault();c.stopPropagation();if(!d.is(".disabled, :disabled")){var e=b(d),f=e.hasClass("open");if(!f&&27!=c.which||f&&27==c.which)return 27==c.which&&e.find('[data-toggle="dropdown"]').trigger("focus"),
d.trigger("click");d=e.find(".dropdown-menu li:not(.disabled):visible a");d.length&&(e=d.index(c.target),38==c.which&&0<e&&e--,40==c.which&&e<d.length-1&&e++,~e||(e=0),d.eq(e).trigger("focus"))}}};var e=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),e=c.data("bs.dropdown");e||c.data("bs.dropdown",e=new d(this));"string"==typeof b&&e[b].call(c)})};a.fn.dropdown.Constructor=d;a.fn.dropdown.noConflict=function(){a.fn.dropdown=e;return this};a(document).on("click.bs.dropdown.data-api",
c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",'[data-toggle="dropdown"]',d.prototype.toggle).on("keydown.bs.dropdown.data-api",'[data-toggle="dropdown"]',d.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",d.prototype.keydown)}(jQuery);

var pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,sec=function(a){return 1/Math.cos(a)},csc=function(a){return 1/Math.sin(a)},cot=function(a){return 1/Math.tan(a)},arcsec=function(a){return arccos(1/a)},arccsc=function(a){return arcsin(1/a)},arccot=function(a){return arctan(1/a)},sinh=function(a){return(Math.exp(a)-Math.exp(-a))/2},cosh=function(a){return(Math.exp(a)+Math.exp(-a))/2},tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))},
sech=function(a){return 1/cosh(a)},csch=function(a){return 1/sinh(a)},coth=function(a){return 1/tanh(a)},arcsinh=function(a){return ln(a+Math.sqrt(a*a+1))},arccosh=function(a){return ln(a+Math.sqrt(a*a-1))},arctanh=function(a){return ln((1+a)/(1-a))/2};sech=function(a){return 1/cosh(a)};csch=function(a){return 1/sinh(a)};coth=function(a){return 1/tanh(a)};
var arcsech=function(a){return arccosh(1/a)},arccsch=function(a){return arcsinh(1/a)},arccoth=function(a){return arctanh(1/a)},sign=function(a){return 0==a?0:0>a?-1:1},logten=function(a){return Math.LOG10E*Math.log(a)},sinn=function(a,d){return Math.pow(Math.sin(d),a)},cosn=function(a,d){return Math.pow(Math.cos(d),a)},tann=function(a,d){return Math.pow(Math.tan(d),a)},cscn=function(a,d){return 1/Math.pow(Math.sin(d),a)},secn=function(a,d){return 1/Math.pow(Math.cos(d),a)},cotn=function(a,d){return 1/
Math.pow(Math.tan(d),a)};function factorial(a,d){null==d&&(d=1);for(var g=a-d;0<g;g-=d)a*=g;return 0>a?NaN:0==a?1:a}function C(a,d){for(var g=1,l=0;l<d;l++)g*=(a-l)/(d-l);return g}function matchtolower(a){return a.toLowerCase()}function nthroot(a,d){return safepow(d,1/a)}function nthlogten(a,d){return Math.log(d)/Math.log(a)}var funcstoindexarr="sinh cosh tanh sech csch coth sqrt ln log sin cos tan sec csc cot abs root arcsin arccos arctan arcsec arccsc arccot arcsinh arccosh arctanh arcsech arccsch arccoth".split(" ");
function functoindex(a){for(var d=0;d<funcstoindexarr.length;d++)if(funcstoindexarr[d]==a)return"@"+d+"@"}function indextofunc(a,d){return funcstoindexarr[d]}function safepow(a,d){if(0>a&&Math.floor(d)!=d){for(var g=3;50>g;g+=2)if(1E-6>Math.abs(Math.round(g*d)-g*d))return 0==Math.round(g*d)%2?Math.pow(Math.abs(a),d):-1*Math.pow(Math.abs(a),d);return Math.sqrt(-1)}return Math.pow(a,d)}
function mathjs(a,d){a=a.replace("[","(");a=a.replace("]",")");a=a.replace(/root\s*(\d+)/,"root($1)");a=a.replace(/\|(.*?)\|/g,"abs($1)");a=a.replace(/arc(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)/gi,"$1^-1");a=a.replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Ln|Sqrt)/gi,matchtolower);a=a.replace(/(sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex);if(null!=d&&""!=d){var g=d.split("|");g.push("pi");g.sort(function(a,b){return b.length-a.length});
d=g.join("|");for(var l=[],h=0;h<g.length;h++){l[h]=!1;for(var c=0;c<g.length;c++)if(h!=c&&g[c].toLowerCase()==g[h].toLowerCase()&&g[c]!=g[h]){l[h]=!0;break}}a=a.replace(new RegExp("("+d+")","gi"),function(a,b){for(var c=0;c<g.length;c++)if(g[c]==b||!l[c]&&g[c].toLowerCase()==b.toLowerCase())return"(@v"+c+"@)"})}else a=a.replace(/pi/g,"(pi)");a=a.replace(/([0-9])E([\-0-9])/g,"$1(EE)$2");a=a.replace(/e/g,"(E)");a=a.replace(/@(\d+)@/g,indextofunc);a=a.replace(/log_([a-zA-Z\d\.]+)\s*\(/g,"nthlog($1,");
a=a.replace(/log_\(([a-zA-Z\/\d\.]+)\)\s*\(/g,"nthlog($1,");a=a.replace(/log/g,"logten");a=a.replace(/(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)\^-1/g,"arc$1");a=a.replace(/(sin|cos|tan|sec|csc|cot)\^(\d+)\s*\(/g,"$1n($2,");a=a.replace(/root\s*\((\d+)\)\s*\(/g,"nthroot($1,");a=a.replace(/([0-9])\s+([0-9])/g,"$1*$2");a=a.replace(/#/g,"");a=a.replace(/\s/g,"");null!=d&&""!=d&&(a=a.replace(/@v(\d+)@/g,function(a,b){return g[b]}));a=a.replace(/([0-9])([\(a-zA-Z])/g,"$1*$2");a=a.replace(/(!)([0-9\(a-zA-Z])/g,
"$1*$2");a=a.replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1");a=a.replace(/([0-9])\*\(EE\)\*?([\-0-9])/g,"$1e$2");for(var f,b,k;-1!=(h=a.indexOf("!"));){if(0==h)return"Error: missing argument";c=h-1;b=a.charAt(c);if("0"<=b&&"9">=b){for(c--;0<=c&&"0"<=(b=a.charAt(c))&&"9">=b;)c--;if("."==b)for(c--;0<=c&&"0"<=(b=a.charAt(c))&&"9">=b;)c--}else if(")"==b){k=1;for(c--;0<=c&&0<k;)b=a.charAt(c),"("==b?k--:")"==b&&k++,c--;for(;0<=c&&("a"<=(b=a.charAt(c))&&"z">=b||"A"<=b&&"Z">=b);)c--}else if("a"<=b&&"z">=b||"A"<=
b&&"Z">=b)for(c--;0<=c&&("a"<=(b=a.charAt(c))&&"z">=b||"A"<=b&&"Z">=b);)c--;else return"Error: incorrect syntax in "+a+" at position "+c;a=a.slice(0,c+1)+"factorial("+a.slice(c+1,h)+")"+a.slice(h+1)}for(;-1!=(h=a.lastIndexOf("^"));){if(0==h)return"Error: missing argument";c=h-1;b=a.charAt(c);if("0"<=b&&"9">=b){for(c--;0<=c&&"0"<=(b=a.charAt(c))&&"9">=b;)c--;if("."==b)for(c--;0<=c&&"0"<=(b=a.charAt(c))&&"9">=b;)c--}else if(")"==b){k=1;for(c--;0<=c&&0<k;)b=a.charAt(c),"("==b?k--:")"==b&&k++,c--;for(;0<=
c&&("a"<=(b=a.charAt(c))&&"z">=b||"A"<=b&&"Z">=b);)c--}else if("a"<=b&&"z">=b||"A"<=b&&"Z">=b)for(c--;0<=c&&("a"<=(b=a.charAt(c))&&"z">=b||"A"<=b&&"Z">=b);)c--;else return"Error: incorrect syntax in "+a+" at position "+c;if(h==a.length-1)return"Error: missing argument";f=h+1;b=a.charAt(f);nch=a.charAt(f+1);if("0"<=b&&"9">=b||"-"==b&&"("!=nch||"."==b){for(f++;f<a.length&&"0"<=(b=a.charAt(f))&&"9">=b;)f++;if("."==b)for(f++;f<a.length&&"0"<=(b=a.charAt(f))&&"9">=b;)f++}else if("("==b||"-"==b&&"("==nch)for("-"==
b&&f++,k=1,f++;f<a.length&&0<k;)b=a.charAt(f),"("==b?k++:")"==b&&k--,f++;else if("a"<=b&&"z">=b||"A"<=b&&"Z">=b){for(f++;f<a.length&&("a"<=(b=a.charAt(f))&&"z">=b||"A"<=b&&"Z">=b);)f++;if("("==b&&a.slice(h+1,f).match(/^(sinn|cosn|tann|secn|cscn|cotn|sin|cos|tan|sec|csc|cot|logten|nthlogten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot|factorial|safepow)$/))for(k=1,f++;f<a.length&&0<k;)b=a.charAt(f),
"("==b?k++:")"==b&&k--,f++}else return"Error: incorrect syntax in "+a+" at position "+f;a=a.slice(0,c+1)+"safepow("+a.slice(c+1,h)+","+a.slice(h+1,f)+")"+a.slice(f)}return a};

function updateeeddpos(){}function updateehpos(){}var LivePreviews=[];
function setupLivePreview(a){LivePreviews.hasOwnProperty(a)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[a]={delay:"MathJax"==mathRenderer?100:20,finaldelay:1E3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,Init:function(){$("#p"+a).css("positive","relative").append('<span id="lpbuf1'+a+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+a+'" style="visibility:hidden;position:absolute;"></span>');this.preview=
document.getElementById("lpbuf1"+a);this.buffer=document.getElementById("lpbuf2"+a)},SwapBuffers:function(){var a=this.preview,c=this.buffer;this.buffer=a;this.preview=c;a.style.visibility="hidden";a.style.position="absolute";c.style.position="";c.style.visibility=""},Update:function(a){this.timeout&&clearTimeout(this.timeout);this.finaltimeout&&clearTimeout(this.finaltimeout);this.timeout=setTimeout(this.callback,this.delay);this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(a){this.buffer.innerHTML=
this.oldtext=a;this.mjRunning=!0;this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),0<$(this.buffer).children(".mj").length?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+a).trigger("click")},preformat:function(b){if(intcalctoproc.hasOwnProperty(a))calcformat[a].match(/inequality/)?(b=b.replace(/<=/g,
" le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt "),b.match(/all\s*real/i)&&(b="text("+b+")")):b=b.replace(/U/g,"uu");else if(vlist.hasOwnProperty(a))b=AMnumfuncPrepVar(a,b)[1];else if(calcformat.hasOwnProperty(a)){var c=calcformat[a];-1==c.indexOf("list")&&-1==c.indexOf("set")&&(b=b.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"));-1!=c.indexOf("scinot")&&(b=b.replace(/(x|X|\u00D7)/,"xx"))}return b},CreatePreview:function(){this.timeout=null;if(!this.mjPending){var b=null==document.getElementById("tc"+
a)?document.getElementById("qn"+a).value:document.getElementById("tc"+a).value;b!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=b,this.buffer.innerHTML="`"+this.preformat(b)+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1;this.SwapBuffers();updateeeddpos();updateehpos()}},LivePreviews[a].callback=MathJax.Callback(["CreatePreview",LivePreviews[a]]),LivePreviews[a].callback.autoReset=!0,
LivePreviews[a].Init()):LivePreviews[a]={finaldelay:1E3,finaltimeout:null,Update:function(a){this.finaltimeout&&clearTimeout(this.finaltimeout);this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(b){var c=document.getElementById("p"+a);c.innerHTML=b;rendermathnode(c)},DoFinalPreview:function(){$("#pbtn"+a).trigger("click")}})}function updateLivePreview(a){a=a.id.substr(2);setupLivePreview(a);LivePreviews[a].Update()}
function normalizemathunicode(a){a=a.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"");a=a.replace(/\u2013|\u2014|\u2015|\u2212/g,"-");a=a.replace(/\u2044|\u2215/g,"/");a=a.replace(/\u221e/g,"oo").replace(/\u2264/g,"<=").replace(/\u2265/g,">=").replace(/\u222a/g,"U");a=a.replace(/\u00b1/g,"+-").replace(/\u00f7/g,"/").replace(/\u00b7|\u2715|\u00d7|\u22c5/g,"*");a=a.replace(/\u221a/g,"sqrt").replace(/\u221b/g,"root(3)");a=a.replace(/\u00b2/g,"^2").replace(/\u00b3/g,"^3");a=a.replace(/\u2329/g,"<").replace(/\u232a/g,
">");a=a.replace(/\u2080/g,"_0").replace(/\u2081/g,"_1").replace(/\u2082/g,"_2").replace(/\u2083/g,"_3");a=a.replace(/\bOO\b/i,"oo");a=a.replace(/\u03b8/,"theta").replace(/\u03d5/,"phi").replace(/\u03c6/,"phi").replace(/\u03c0/,"pi").replace(/\u03c3/,"sigma").replace(/\u03bc/,"mu");a=a.replace(/\u03b1/,"alpha").replace(/\u03b2/,"beta").replace(/\u03b3/,"gamma").replace(/\u03b4/,"delta").replace(/\u03b5/,"epsilon").replace(/\u03ba/,"kappa");a=a.replace(/\u03bb/,"lambda").replace(/\u03c1/,"rho").replace(/\u03c4/,
"tau").replace(/\u03c7/,"chi").replace(/\u03c9/,"omega");return a=a.replace(/\u03a9/,"Omega").replace(/\u0393/,"Gamma").replace(/\u03a6/,"Phi").replace(/\u0394/,"Delta").replace(/\u03a3/,"Sigma")}function wrapAMnotice(a){return'<span class="AMHnotice">'+a+"</span>"}
function calculate(a,b,c){var d=document.getElementById(a).value;d=normalizemathunicode(d);d=d.replace(/=/,"");if(-1!=c.indexOf("list"))var e=d.split(/,/);else-1!=c.indexOf("set")?e=d.replace(/[\{\}]/g,"").split(/,/):(e=[],e[0]=d);for(d=0;d<e.length;d++){str=e[d];str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1");var g="";if(str.match(/DNE/i))str=str.toUpperCase();else if(str.match(/oo$/)||str.match(/oo\W/))str="`"+str+"`";else{g+=singlevalsyntaxcheck(str,c);str.match(/,/)&&(g+=_("Invalid use of a comma."));
-1!=c.indexOf("allowxtimes")&&(str=str.replace(/(x|X|\u00D7)/,"*"));-1!=c.indexOf("mixed")?str=str.replace(/_/g," "):-1!=c.indexOf("scinot")?str=str.replace(/(x|X|\u00D7)/,"xx"):(str=str.replace(/([0-9])\s+([0-9])/g,"$1*$2"),str=str.replace(/\s/g,""));g+=syntaxcheckexpr(str,c);try{var f=str;f=f.replace(",","*NaN*");f.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(f=f.replace(/%/,"")+"/100");-1!=c.indexOf("mixed")&&(f=f.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"));-1!=
c.indexOf("scinot")&&(f=f.replace("xx","*"));var h=eval(prepWithMath(mathjs(f)))}catch(m){g=_("syntax incomplete")+". "+g,h=NaN}isNaN(h)||"Infinity"==h?""!=str&&(str="`"+str+"` = "+_("undefined")+". "+wrapAMnotice(g)):str=-1==c.indexOf("showval")?"`"+str+"` "+wrapAMnotice(g):"`"+str+" =` "+(1E-15>Math.abs(h)?0:h)+". "+wrapAMnotice(g)}e[d]=str+" "}d=e.join(", ");-1!=c.indexOf("set")&&(d=document.getElementById(a).value.match(/^\s*{.*?}\s*$/)?"{"+d+"}":d+wrapAMnotice(_("syntax error: this answer must be in set notation, a list wrapped in braces like {1,2,3}")));
a=b.substr(1);setupLivePreview(a);LivePreviews[a].RenderNow(d)}
function ineqtointerval(a){a=a.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1");a=a.split(/or/);for(i=0;i<a.length;i++){str=a[i];var b="";(pat=str.match(/^([^<]+)\s*(<=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(<=?)([^<]+)$/))?(b="<="==pat[2]?b+"[":b+"(",b+=pat[1]+","+pat[5],b="<="==pat[4]?b+"]":b+")"):(pat=str.match(/^([^>]+)\s*(>=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(>=?)([^>]+)$/))?(b=">="==pat[4]?b+"[":b+"(",b+=pat[5]+","+pat[1],b=">="==pat[2]?b+"]":b+")"):(pat=str.match(/^([^><]+)\s*([><]=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*$/))?
">"==pat[2]?b="(-oo,"+pat[1]+")":">="==pat[2]?b="(-oo,"+pat[1]+"]":"<"==pat[2]?b="("+pat[1]+",oo)":"<="==pat[2]&&(b="["+pat[1]+",oo)"):(pat=str.match(/^\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*([><]=?)\s*([^><]+)$/))?"<"==pat[2]?b="(-oo,"+pat[3]+")":"<="==pat[2]?b="(-oo,"+pat[3]+"]":">"==pat[2]?b="("+pat[3]+",oo)":">="==pat[2]&&(b="["+pat[3]+",oo)"):b=str.match(/all\s*real/i)?"(-oo,oo)":"";a[i]=b}return b=a.join("U")}
function intcalculate(a,b,c){a=document.getElementById(a).value;a=-1!=c.indexOf("mixed")?a.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):a.replace(/\s+/g,"");a=normalizemathunicode(a);if(a.match(/DNE/i))a=a.toUpperCase();else if(""==a.replace(/\s+/g,""))a=_("no answer given");else{var d=[],e=[];if(-1!=c.indexOf("inequality")){var g=a=a.replace(/or/g," or ");a=ineqtointerval(a);var f=str.match(/\b([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+\b)/),h=str.match(/([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)/);
f=null!=f?f[1]:null!=h?h[1]:""}else g=a;if(-1!=c.indexOf("list")){var m=0;h=[];for(var l=1;l<a.length-1;l++)","!=a.charAt(l)||")"!=a.charAt(l-1)&&"]"!=a.charAt(l-1)||"("!=a.charAt(l+1)&&"["!=a.charAt(l+1)||(h.push(a.substring(m,l)),m=l+1);h.push(a.substring(m))}else h=a.split(/\s*U\s*/i);m=!0;l="";for(i=0;i<h.length;i++){str=h[i];sm=str.charAt(0);em=str.charAt(str.length-1);vals=str.substring(1,str.length-1);vals=vals.split(/,/);if(2!=vals.length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=c.indexOf("inequality")?
(g=g.replace("<=","le").replace(">=","ge").replace("<","lt").replace(">","gt"),a="`"+g+"`: "+wrapAMnotice(_("invalid inequality notation"))):a="`"+g.replace(/U/g,"uu")+"`: "+wrapAMnotice(_("invalid interval notation"));m=!1;break}for(j=0;2>j;j++)if(vals[j].match(/oo$/)||vals[j].match(/oo\W/))d[j]=vals[j];else{var n="";q=NaN;n+=singlevalsyntaxcheck(vals[j],c);-1!=c.indexOf("mixed")?vals[j]=vals[j].replace(/_/g," "):vals[j]=vals[j].replace(/\s/g,"");n+=syntaxcheckexpr(vals[j],c);if(""==n)try{toeval=
vals[j];-1!=c.indexOf("mixed")&&(toeval=toeval.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"));var q=eval(prepWithMath(mathjs(toeval)))}catch(p){n=_("syntax incomplete")+". "}isNaN(q)||"Infinity"==q?d[j]=_("undefined"):(vals[j]=vals[j],d[j]=(1E-15>Math.abs(q)?0:q).toString());""!=n&&(l+=n)}h[i]=sm+vals[0]+","+vals[1]+em;-1!=c.indexOf("inequality")?(d[0].match(/oo/)?d[1].match(/oo/)?e[i]="RR":e[i]=f+("]"==em?"le":"lt")+d[1]:d[1].match(/oo/)?e[i]=f+("["==sm?"ge":"gt")+d[0]:e[i]=
d[0]+("["==sm?"le":"lt")+f+("]"==em?"le":"lt")+d[1],e[i]=e[i].replace("undefined",'"undefined"')):e[i]=sm+d[0]+","+d[1]+em}m&&(-1!=c.indexOf("inequality")?g.match(/all\s*real/)?a=g:(g=g.replace(/or/g,' \\ "or" \\ '),g=g.replace(/<=/g,"le"),g=g.replace(/>=/g,"ge"),g=g.replace(/</g,"lt"),g=g.replace(/>/g,"gt"),a=-1==c.indexOf("showval")?"`"+g+"`. "+wrapAMnotice(l):"`"+g+"= "+e.join(' \\ "or" \\ ')+"`. "+wrapAMnotice(l)):a=-1==c.indexOf("showval")?"`"+h.join("uu")+"`. "+wrapAMnotice(l):-1!=c.indexOf("list")?
"`"+h.join(",")+"` = "+e.join(" , ")+". "+wrapAMnotice(l):"`"+h.join("uu")+"` = "+e.join(" U ")+". "+wrapAMnotice(l))}b=b.substr(1);setupLivePreview(b);LivePreviews[b].RenderNow(a)}
function ntuplecalc(a,b,c){var d=document.getElementById(a).value;d=normalizemathunicode(d);d=-1!=c.indexOf("mixed")?d.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):d.replace(/\s+/g,"");if(d.match(/DNE/i))d.toUpperCase(),outstr=a="DNE";else{a="";var e=0,g=0,f="",h=!0;d.charAt(0).match(/[\(\[<\{]/)||(h=!1);for(var m=0;m<d.length;m++)if(dec=!1,0==e&&(a+=d.charAt(m),g=m+1,","==d.charAt(m)&&(d.charAt(m+1).match(/[\(\[<\{]/)&&d.charAt(m-1).match(/[\)\]>\}]/)||(h=!1))),d.charAt(m).match(/[\(\[<\{]/)?
e++:d.charAt(m).match(/[\)\]>\}]/)&&(e--,dec=!0),0==e&&dec||1==e&&","==d.charAt(m)){sub=d.substring(g,m);g=NaN;if("oo"==sub||"-oo"==sub)a+=sub;else{f+=singlevalsyntaxcheck(sub,c);f+=syntaxcheckexpr(sub,c);try{-1!=c.indexOf("mixed")&&(sub=sub.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),g=eval(prepWithMath(mathjs(sub)))}catch(l){f+=_("syntax incomplete")+". "}a=isNaN(g)||"Infinity"==g?a+_("undefined"):a+g}a+=d.charAt(m);g=m+1}0!=e&&(h=!1);0==h&&(f+=_("Invalid notation")+". ");
outstr=-1==c.indexOf("showval")||0==h?"`"+d+"`. "+wrapAMnotice(f):"`"+d+"` = "+a+". "+wrapAMnotice(f)}null!=b&&(b=b.substr(1),setupLivePreview(b),LivePreviews[b].RenderNow(outstr));return a}
function complexcalc(a,b,c){var d=document.getElementById(a).value;d=normalizemathunicode(d);d=-1!=c.indexOf("mixed")?d.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):d.replace(/\s+/g,"");if(d.match(/DNE/i))d.toUpperCase(),c=a="DNE";else{var e=a="";for(var g=d.split(","),f=0;f<g.length;f++){var h=g[f];-1!=c.indexOf("mixed")&&(h=h.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"));h=mathjs(h,"i");if(-1==c.indexOf("sloppycomplex")){var m=parsecomplex(g[f]);"string"==typeof m?
e+=m:(e+=singlevalsyntaxcheck(m[0],c),e+=singlevalsyntaxcheck(m[1],c))}e+=syntaxcheckexpr(g[f],c);if(""==e)try{var l=scopedeval("var i=0;"+prepWithMath(h)),n=scopedeval("var i=1;"+prepWithMath(h)),q=scopedeval("var i=-1;"+prepWithMath(h))}catch(p){e+=_("syntax incomplete")}if("synerr"==l||"synerr"==n)e+=_("syntax incomplete"),l=NaN;if(isNaN(l)||"Infinity"==l||isNaN(n)||isNaN(q)||"Infinity"==n){a+=_("undefined");break}else n-=l,0!=f&&(a+=","),a+=l+(0<=n?"+":"")+n+"i"}c=-1==c.indexOf("showval")?"`"+
d+"`. "+wrapAMnotice(e):"`"+d+"` = "+a+". "+wrapAMnotice(e)}null!=b&&(b=b.substr(1),setupLivePreview(b),LivePreviews[b].RenderNow(c));return a}
function parsecomplex(a){var b,c;a=a.replace(/\s/,"");a=a.replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2");a=a.replace(/sin/,"s$n");a=a.replace(/pi/,"p$");var d=a.length;if(2<a.split("i").length)return _("error - more than 1 i in expression");var e=a.indexOf("i");if(-1==e){var g=a;var f="0"}else{f=0;for(c=e-1;0<c;c--)if(g=a.charAt(c),")"==g)f++;else if("("==g)f--;else if(("+"==g||"-"==g)&&0==f)break;0>c&&(c=0);if(0!=f)return _("error - invalid form");f=0;for(b=e+1;b<d;b++)if(g=a.charAt(b),"("==g)f++;else if(")"==
g)f--;else if(("+"==g||"-"==g)&&0==f)break;if(0!=f)return _("error - invalid form");if(0<e-c&&0<b-e&&(b==d||0==c)){if(b==d)g=a.substr(0,c),f=a.substr(c,e-c);else if(0==c)g=a.substr(b),f=a.substr(0,e);else return _("error - invalid form");f+="*"+a.substr(e+1+("*"==a.charAt(e+1)?1:0),b-e-1);f=f.replace("-*","-1*").replace("+*","+1*");f=f.replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(1<e-c)f=a.substr(c,e-c),g=a.substr(0,c)+a.substr(e+1);else if(1<b-e)if(0<e){if("+"!=a.charAt(e-1)&&"-"!=a.charAt(e-1))return _("error - invalid form");
f=a.charAt(e-1)+a.substr(e+1+("*"==a.charAt(e+1)?1:0),b-e-1);g=a.substr(0,e-1)+a.substr(b)}else f=a.substr(e+1,b-e-1),g=a.substr(0,e)+a.substr(b);else f="+"==a.charAt(c)?"1":"-"==a.charAt(c)?"-1":0==e?"1":a.charAt(c),g=(0<e?a.substr(0,c):"")+a.substr(e+1);""==g&&(g="0");"/"==f.charAt(0)?f="1"+f:"+"!=f.charAt(0)&&"-"!=f.charAt(0)||"/"!=f.charAt(1)||(f=f.charAt(0)+"1"+f.substr(1));"*"==f.charAt(f.length-1)&&(f=f.substr(0,f.length-1));"+"==f.charAt(0)&&(f=f.substr(1));"+"==g.charAt(0)&&(g=g.substr(1))}g=
g.replace("s$n","sin");g=g.replace("p$","pi");f=f.replace("s$n","sin");f=f.replace("p$","pi");f=f.replace(/\*\//g,"/");return[g,f]}
function matrixcalc(a,b,c,d,e){function g(a){var b="";try{var e=eval(prepWithMath(mathjs(a)))}catch(r){b=_("syntax incomplete")+". "}isNaN(e)||"Infinity"==e?""!=a&&(a=b=_("undefined")+". "):a=(1E-15>Math.abs(e)?0:e)+b;return[a,b]}var f="";"string"!=typeof e&&(e="");if(null!=c&&null!=d){for(var h=0,m="[",l="[",n=0;n<c;n++){0<n&&(m+=",",l+=",");m+="(";l+="(";for(var q=0;q<d;q++){0<q&&(m+=",",l+=",");val=normalizemathunicode(document.getElementById(a+"-"+h).value);m+=val;var p=g(val);p[1]+=syntaxcheckexpr(val,
e);""==p[1]&&(p[1]+=singlevalsyntaxcheck(val,e));""==f&&(f=p[1]);l+=p[0];h++}m+=")";l+=")"}m+="]";l+="]"}else{m=normalizemathunicode(document.getElementById(a).value);p=0;l=m.replace("[","(");l=l.replace("]",")");l=l.replace(/\s+/g,"");c=[];l=l.substring(1,l.length-1);for(a=d=0;a<l.length;a++)"("==l.charAt(a)?p++:")"==l.charAt(a)?p--:","==l.charAt(a)&&0==p&&(c[c.length]=l.substring(d+1,a-1),d=a+1);c[c.length]=l.substring(d+1,l.length-1);for(a=0;a<c.length;a++){calclist2=c[a].split(",");for(l=0;l<
calclist2.length;l++)p=g(calclist2[l]),p[1]+=syntaxcheckexpr(calclist2[l],e),""==p[1]&&(p[1]+=singlevalsyntaxcheck(calclist2[l],e)),""==f&&(f=p[1]),calclist2[l]=p[0];c[a]=calclist2.join(",")}l="[("+c.join("),(")+")]"}m=-1==e.indexOf("showval")?"`"+m+"`. "+f:"`"+m+"` = `"+l+"`. "+f;if(null!=b){b=document.getElementById(b);e=b.childNodes.length;for(a=0;a<e;a++)b.removeChild(b.firstChild);b.appendChild(document.createTextNode(m));noMathRender||rendermathnode(b)}return l}
function mathjsformat(a,b){var c=document.getElementById(a).value;document.getElementById(b).value=mathjs(c)}function stringqpreview(a,b){var c=document.getElementById(a).value,d=b.substr(1);setupLivePreview(d);LivePreviews[d].RenderNow("`"+c+"`")}
function AMnumfuncPrepVar(a,b){var c=vlist[a],d=flist[a],e=c.split("|");e.push("DNE");b=b.replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,"");b=normalizemathunicode(b);var g=[];var f=b.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex);for(var h=0;h<e.length;h++)if("varE"==e[h])b=b.replace("E","varE"),f=f.replace("E","varE");else{g[h]=!1;for(var m=0;m<e.length;m++)if(h!=
m&&e[m].toLowerCase()==e[h].toLowerCase()&&e[m]!=e[h]){g[h]=!0;break}}b=b.replace(new RegExp("("+c+")","gi"),function(a,b){for(var c=0;c<e.length;c++)if(e[c]==b||!g[c]&&e[c].toLowerCase()==b.toLowerCase())return"@v"+c+"@"});b=b.replace(/@v(\d+)@/g,function(a,b){return e[b]});f=f.replace(new RegExp("("+c+")","gi"),function(a,b){for(var c=0;c<e.length;c++)if(e[c]==b||!g[c]&&e[c].toLowerCase()==b.toLowerCase())return"@v"+c+"@"});f=f.replace(/@v(\d+)@/g,function(a,b){return e[b]});m=[];for(h=0;h<e.length;h++)if(1<
e[h].length){var l=!1;-1!=arraysearch(e[h].toLowerCase(),greekletters)&&(l=!0);if(e[h].match(/^\w+_\w+$/)){l=g[h]?"g":"gi";var n=(new RegExp(/^(\w+)_(\w+)$/,l)).exec(e[h]),q=new RegExp(n[1]+"_\\("+n[2]+"\\)",l);f=f.replace(q,e[h]);b=b.replace(q,e[h]);1<n[1].length&&-1==arraysearch(n[1].toLowerCase(),greekletters)&&(n[1]='"'+n[1]+'"');1<n[2].length&&-1==arraysearch(n[2].toLowerCase(),greekletters)&&(n[2]='"'+n[2]+'"');f=f.replace(new RegExp(n[0],l),n[1]+"_"+n[2]);b=b.replace(new RegExp(n[0],"g"),"repvars"+
h);e[h]="repvars"+h}else l||"varE"==e[h]||m.push(e[h])}0<m.length&&(vltq=m.join("|"),f=f.replace(new RegExp("("+vltq+")","g"),'"$1"'));f=f.replace("varE","E");f=f.replace(/@(\d+)@/g,indextofunc);c.match(/\bf\b/)&&!d.match(/\bf\b/)&&(f=f.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3"),f=f.replace(/([^a-zA-Z])f\(/g,"$1f{::}("));c.match(/\bg\b/)&&!d.match(/\bg\b/)&&(f=f.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3"),f=f.replace(/([^a-zA-Z])g\(/g,"$1g{::}("));return[b,f,e.join("|")]}
function AMpreview(a,b){var c=a.slice(2),d=AMnumfuncPrepVar(c,document.getElementById(a).value),e=d[0],g=d[1],f=d[2],h=flist[c];ptlist=pts[c].split(",");var m="",l=0;d=NaN;var n=!1;1==iseqn[c]?(e.match(/=/)?1<e.match(/=/g).length&&(n=!0):n=!0,e=e.replace(/(.*)=(.*)/,"$1-($2)")):e.match(/=/)||(n=!0);""!=h&&(reg=new RegExp("("+h+")\\(","g"),e=e.replace(reg,"$1*sin($1+"));vars=f.split("|");for(h=prepWithMath(mathjs(e,f));l<ptlist.length&&(isNaN(d)||"Infinity"==d);){var q="";testvals=ptlist[l].split("~");
for(m=0;m<vars.length;m++)q+="var "+vars[m]+"="+testvals[m]+";";q+=h;m=_("syntax ok");try{d=scopedeval(q)}catch(p){m=_("syntax error")}"synerr"==d&&(m=_("syntax error"));l++}e=syntaxcheckexpr(e,"",f);if(isNaN(d)||"Infinity"==d)m=_("syntax error");""!=e&&(m=m==_("syntax ok")?m+(". "+_("warning")+": "+e):m+(". "+e));1==iseqn[c]&&n?m=_("syntax error: this is not an equation"):"undefined"!==typeof iseqn[c]||n||(m=_("syntax error: you gave an equation, not an expression"));if('"DNE"'==g||"oo"==g)m=_("syntax ok");
c=b.substr(1);setupLivePreview(c);LivePreviews[c].RenderNow("`"+g+"` "+wrapAMnotice(m))}function AMmathpreview(a,b){for(var c=document.getElementById(a).value,d=document.getElementById(b),e=d.childNodes.length,g=0;g<e;g++)d.removeChild(d.firstChild);d.appendChild(document.createTextNode("`"+c+"`"));noMathRender||rendermathnode(d)}
function singlevalsyntaxcheck(a,b){if(!a.match(/DNE/i)&&!a.match(/oo$/)&&!a.match(/oo\W/))if(-1!=b.indexOf("fracordec")){if(a=a.replace(/\s/g,""),!a.match(/^\-?\(?\d+\s*\/\s*\-?\d+\)?$/)&&!a.match(/^\-?\d+$/)&&!a.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" invalid entry format")+". "}else if(-1!=b.indexOf("fraction")||-1!=b.indexOf("reducedfraction")){if(a=a.replace(/\s/g,""),!a.match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)&&!a.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)&&!a.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+
". "}else if(-1!=b.indexOf("mixednumber")){if(!(a.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||a.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||a.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||a.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";a.replace(/_/," ")}else if(-1!=b.indexOf("scinot")){if(a=a.replace(/\s/g,""),a=a.replace(/(x|X|\u00D7)/,"xx"),!a.match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\-?\d+\)?)$/)){if(-1==b.indexOf("scinotordec"))return _("not valid scientific notation")+
". ";if(!a.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=b.indexOf("decimal")&&-1==b.indexOf("nodecimal")&&!a.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" not a valid integer or decimal number")+". ";return""}
function syntaxcheckexpr(a,b,c){var d="";-1!=b.indexOf("notrig")&&a.match(/(sin|cos|tan|cot|sec|csc)/i)?d+=_("no trig functions allowed")+". ":-1!=b.indexOf("nodecimal")&&-1!=a.indexOf(".")&&(d+=_("no decimals allowed")+". ");for(var e=b=0,g=0,f=0;f<a.length;f++)"("==a.charAt(f)?b++:")"==a.charAt(f)?b--:"["==a.charAt(f)?e++:"]"==a.charAt(f)?e--:"|"==a.charAt(f)&&(g=1-g);if(0!=b||0!=e)d+=" ("+_("unmatched parens")+"). ";0!=g&&(d+=" ("+_("unmatched absolute value bars")+"). ");reg=c?new RegExp("(sqrt|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+
c+"|\\d+)","i"):/(sqrt|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\d+)/i;errstuff=a.match(reg);null!=errstuff&&(d+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. ");c&&(reg=new RegExp("(repvars\\d+|arc|sqrt|root|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo|"+c+")","ig"),a.replace(reg,"").match(/[a-zA-Z]/)&&(d+=_(" Check your variables - you might be using an incorrect one")+
". "));if(2<(a.match(/\|/g)||[]).length)for(c=/\|.*?\|\s*(.|$)/g;match=c.exec(a);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){d+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}a.match(/%/)&&!a.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(d+=_(" Do not use the percent symbol, %")+". ");return d}
var greekletters="alpha beta chi delta epsilon gamma varphi phi psi sigma rho theta lambda mu nu omega tau".split(" "),calctoproc={},intcalctoproc={},calcformat={},functoproc={},matcalctoproc={},ntupletoproc={},complextoproc={},callbackstack={},matsize={},vlist={},flist={},pts={},iseqn={};
function doonsubmit(a,b,c){for(var d in callbackstack)callbackstack[d](d);if(null!=a){if("submitted"==a.className)return alert(_("You have already submitted this page.  Please be patient while your submission is processed.")),a.className="submitted2",!1;if("submitted2"==a.className)return!1;a.className="submitted";if(!c&&(b&&1==$("input[name=saveforlater]").attr("data-clicked")?(b=!0,$("input[name=saveforlater]").attr("data-clicked",0)):b=confirmSubmit(a),!b))return a.className="",!1}imathasDraw.encodea11ydraw();
for(d in intcalctoproc)if(d=parseInt(d),null!=document.getElementById("tc"+d)){fullstr=document.getElementById("tc"+d).value;fullstr=-1!=calcformat[d].indexOf("mixed")?fullstr.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):fullstr.replace(/\s+/g,"");fullstr=normalizemathunicode(fullstr);if(fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase();else{-1!=calcformat[d].indexOf("inequality")&&(fullstr=ineqtointerval(fullstr));if(-1!=calcformat[d].indexOf("list")){b=0;a=[];for(c=1;c<fullstr.length-
1;c++)","!=fullstr.charAt(c)||")"!=fullstr.charAt(c-1)&&"]"!=fullstr.charAt(c-1)||"("!=fullstr.charAt(c+1)&&"["!=fullstr.charAt(c+1)||(a.push(fullstr.substring(b,c)),b=c+1);a.push(fullstr.substring(b))}else a=fullstr.split(/\s*U\s*/i);for(k=0;k<a.length;k++)if(str=a[k],0<str.length&&str.match(/,/)){sm=str.charAt(0);em=str.charAt(str.length-1);vals=str.substring(1,str.length-1);vals=vals.split(/,/);for(j=0;2>j;j++)if(!vals[j].match(/oo$/)&&!vals[j].match(/oo\W/)){b="";try{-1!=calcformat[d].indexOf("mixed")&&
(vals[j]=vals[j].replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"));var e=eval(prepWithMath(mathjs(vals[j])))}catch(g){b="syntax incomplete"}isNaN(e)||"Infinity"==e||(vals[j]=(1E-15>Math.abs(e)?0:e)+b)}a[k]=sm+vals[0]+","+vals[1]+em}fullstr=-1!=calcformat[d].indexOf("list")?a.join(","):a.join("U")}document.getElementById("qn"+d).value=fullstr}for(d in calctoproc)if(d=parseInt(d),null!=document.getElementById("tc"+d)){str=document.getElementById("tc"+d).value;str=normalizemathunicode(str);
str=str.replace(/=/,"");if(-1!=calcformat[d].indexOf("list"))a=str.split(/,/);else if(-1!=calcformat[d].indexOf("set"))if(str.match(/^\s*{.*?}\s*$/))a=str.replace(/^\s*{(.*?)}\s*$/,"$1").split(/,/);else continue;else a=[],a[0]=str;for(b=0;b<a.length;b++){str=a[b];str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1");str=str.replace(",","*NaN*");if(-1!=calcformat[d].indexOf("scinot")||-1!=calcformat[d].indexOf("allowxtimes"))str=str.replace(/(x|X|\u00D7)/,"*");str.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&
(str=str.replace(/%/,"")+"/100");str=str.replace(/(\d+)\s*_\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)");-1!=calcformat[d].indexOf("mixed")&&(str=str.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"));if(str.match(/^\s*$/))e="";else if(str.match(/oo$/)||str.match(/oo\W/))e=str;else if(str.match(/DNE/i))e=str.toUpperCase();else try{e=eval(prepWithMath(mathjs(str)))}catch(g){e=""}a[b]=e}document.getElementById("qn"+d).value=a.join(",")}for(d in matcalctoproc){d=parseInt(d);
if(null!=matsize[d]){if(null==document.getElementById("qn"+d+"-0"))continue;msize=matsize[d].split(",");str=matrixcalc("qn"+d,null,msize[0],msize[1])}else{if(null==document.getElementById("tc"+d))continue;str=matrixcalc("tc"+d,null)}document.getElementById("qn"+d).value=str}for(d in ntupletoproc)d=parseInt(d),null!=document.getElementById("tc"+d)&&(str=ntuplecalc("tc"+d,null,calcformat[d]),document.getElementById("qn"+d).value=str);for(d in complextoproc)d=parseInt(d),null!=document.getElementById("tc"+
d)&&(str=complexcalc("tc"+d,null,calcformat[d]),document.getElementById("qn"+d).value=str);for(d in functoproc)if(d=parseInt(d),null!=document.getElementById("tc"+d)){str=document.getElementById("tc"+d).value;str=str.replace(/,/g,"");str=normalizemathunicode(str);e=AMnumfuncPrepVar(d,str);str=e[0];varlist=e[2];if(1==iseqn[d])str=str.replace(/(.*)=(.*)/,"$1-($2)");else if(str.match("="))continue;fl=flist[d];""!=fl&&(reg=new RegExp("("+fl+")\\(","g"),str=str.replace(reg,"$1*sin($1+"));vars=varlist.split("|");
e=document.getElementById("qn"+d);e.value=mathjs(str,varlist);ptlist=pts[d].split(",");vals=[];for(a=0;a<ptlist.length;a++){inputs=ptlist[a].split("~");totest="";for(b=0;b<inputs.length;b++)totest+="var "+vars[b]+"="+inputs[b]+";";totest=""==e.value?totest+(Math.random()+";"):totest+(prepWithMath(e.value)+";");try{vals[a]=scopedeval(totest)}catch(g){vals[a]=NaN}"synerr"==vals[a]&&(vals[a]=NaN)}document.getElementById("qn"+d+"-vals").value=vals.join(",")}return!0}
function scopedeval(a){var b;try{return b=eval(a)}catch(c){return"synerr"}}function arraysearch(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return c;return-1}
function toggleinlinebtn(a,b){var c=document.getElementById(b),d=document.getElementById(a);"none"==d.style.display?(d.style.display="",d.setAttribute("aria-hidden",!1),c.setAttribute("aria-expanded",!0)):(d.style.display="none",d.setAttribute("aria-hidden",!0),c.setAttribute("aria-expanded",!1));d=c.innerHTML;c.innerHTML=d.match(/\[\+\]/)?d.replace(/\[\+\]/,"[-]"):d.replace(/\[\-\]/,"[+]")}
function assessbackgsave(){var a=$(this).attr("name").match(/^(qs|qn|tc)(\d+)/);if(null!==a&&window.FormData){a=1*a[2];1E3<a&&(a=Math.floor(a/1E3+.001)-1);"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();doonsubmit();var b=new FormData,c=new RegExp("^(qn|tc|qs)("+a+"\\b|"+(a+1)+"\\d{3})");$("input,select,textarea").each(function(a,e){e.name.match(c)&&("radio"!=e.type&&"checkbox"!=e.type||e.checked)&&("file"==e.type?b.append(e.name,e.files[0]):b.append(e.name,e.value))});b.append("backgroundsaveforlater",
1);b.append("tosaveqn",a);b.append("asidverify",document.getElementById("asidverify").value);b.append("disptime",document.getElementById("disptime").value);b.append("isreview",document.getElementById("isreview").value);$.ajax({type:"POST",url:window.location.origin+window.location.pathname,data:b,contentType:!1,processData:!1,qn:a}).done(function(a){-1!=assessFormIsDirty.indexOf(1*this.qn)&&assessFormIsDirty.splice(assessFormIsDirty.indexOf(1*this.qn),1)})}}
function assessbackgsubmit(a,b){a=parseInt(a);if(!confirmSubmit($("#embedqwrapper"+a)[0]))return!1;"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();doonsubmit();var c={},d=!!window.FormData;if(d)var e=new FormData;for(var g=[],f=document.getElementsByTagName("input"),h=0;h<f.length;h++)g.push(f[h]);f=document.getElementsByTagName("select");for(h=0;h<f.length;h++)g.push(f[h]);f=document.getElementsByTagName("textarea");for(h=0;h<f.length;h++)g.push(f[h]);f=null!=a?new RegExp("^(qn|tc|qs)("+a+"\\b|"+
(a+1)+"\\d{3})"):/^(qn|tc|qs)/;for(h=0;h<g.length;h++)g[h].name.match(f)&&("radio"!=g[h].type&&"checkbox"!=g[h].type||g[h].checked)&&(d?"file"==g[h].type?e.append(g[h].name,g[h].files[0]):e.append(g[h].name,g[h].value):"file"==g[h].type?alert("File upload submissions are not supported by this browser"):c[g[h].name]=g[h].value);null!==a?d?(e.append("toscore",a),e.append("verattempts",document.getElementById("verattempts"+a).value)):(c.toscore=a,c.verattempts=document.getElementById("verattempts"+a).value):
d?e.append("verattempts",document.getElementById("verattempts").value):c.verattempts=document.getElementById("verattempts").value;d?(e.append("asidverify",document.getElementById("asidverify").value),e.append("disptime",document.getElementById("disptime").value),e.append("isreview",document.getElementById("isreview").value)):(c.asidverify=document.getElementById("asidverify").value,c.disptime=document.getElementById("disptime").value,c.isreview=document.getElementById("isreview").value);c={type:"POST",
url:assesspostbackurl,data:d?e:c,dataType:"text",qn:a,noticetgt:b};d&&(c.contentType=!1,c.processData=!1);$.ajax(c).done(function(a){null!=this.noticetgt&&(document.getElementById(this.noticetgt).innerHTML="");if(null!==this.qn){for(var b=this.qn,c=[];-1<a.indexOf("<script")||-1<a.indexOf("\x3c/script");){var e=a.indexOf("<script"),d=a.indexOf(">",e),f=a.indexOf("\x3c/script",e),g=a.indexOf(">",f);c.push(a.substring(d+1,f));a=a.substring(0,e)+a.substring(g+1)}document.getElementById("embedqwrapper"+
b).innerHTML=a;usingASCIIMath&&rendermathnode(document.getElementById("embedqwrapper"+b));usingASCIISvg&&setTimeout("drawPics()",100);usingTinymceEditor&&initeditor("textareas","mceEditor");for(a=initstack.length=0;a<c.length;a++)try{if(k=c[a].match(/canvases\[(\d+)\]/))"undefined"!=typeof G_vmlCanvasManager&&(c[a]=c[a]+'G_vmlCanvasManager.initElement(document.getElementById("canvas'+k[1]+'"));'),c[a]=c[a]+"imathasDraw.initCanvases("+k[1]+");";eval(c[a])}catch(r){}for(a=0;a<initstack.length;a++)initstack[a]();
c=(b+1).toString().length;for(a in LivePreviews)(a==b||999<a&&a.toString().substr(0,c)==b+1)&&LivePreviews[a].Init();$(window).trigger("ImathasEmbedReload",[b]);-1!=assessFormIsDirty.indexOf(1*b)&&assessFormIsDirty.splice(assessFormIsDirty.indexOf(1*b),1);$("#embedqwrapper"+b).find("input,textarea").on("change",trackDirty);c=0;"undefined"!=typeof window.pageYOffset?c=window.pageYOffset:(c=document.body,a=document.documentElement,a=a.clientHeight?a:c,c=a.scrollTop);var h=findPos(document.getElementById("embedqwrapper"+
b))[1];c>h&&setTimeout(function(){window.scroll(0,h)},150)}}).fail(function(a){null!=this.noticetgt&&(document.getElementById(this.noticetgt).innerHTML=_("Submission Error"))})}function embedEnterHandler(a){$("#"+a+" input[type=text][name^=qn]").off("keydown.embedenterhandler").on("keydown.embedenterhandler",function(a){13==a.which&&(a.preventDefault(),a=parseInt($(this).closest(".embedqwrapper").attr("id").substr(13)),assessbackgsubmit(a,"submitnotice"+a))})}
$(window).on("ImathasEmbedReload",function(a,b){embedEnterHandler("embedqwrapper"+b)});
function AutoSuggest(a,b){var c=this;this.elem=a;this.suggestions=b;this.eligible=[];this.inputText=null;this.highlighted=-1;this.div=document.getElementById("autosuggest");null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));a.setAttribute("autocomplete","off");if(!a.id){var d="autosuggest"+AutoSuggestIdCounter;AutoSuggestIdCounter++;a.id=d}a.onkeydown=function(a){a=
c.getKeyCode(a);switch(a){case 9:c.useSuggestion("tab");break;case 13:return c.useSuggestion("enter"),!1;case 27:c.hideDiv();break;case 38:0<c.highlighted&&c.highlighted--;c.changeHighlight(a);break;case 40:c.highlighted<c.eligible.length-1&&c.highlighted++,c.changeHighlight(a)}};a.onkeyup=function(a){switch(c.getKeyCode(a)){case 9:case 27:case 38:case 40:break;default:1<this.value.length?(c.inputText=this.value,c.getEligible(),c.highlighted=0<c.eligible.length?0:-1,c.createDiv(),c.positionDiv(),
c.showDiv()):(c.hideDiv(),0==this.value.length&&(c.inputText=""))}};a.onblur=function(a){setTimeout(c.hideDiv,100)};this.useSuggestion=function(a){-1<this.highlighted&&(this.elem.value=this.eligible[this.highlighted]);this.hideDiv()};this.showDiv=function(){this.div.style.display="block"};this.hideDiv=function(){c.div.style.display="none";c.highlighted=-1};this.changeHighlight=function(){var a=this.div.getElementsByTagName("LI");for(i in a)a[i].className=this.highlighted==i?"selected":""};this.positionDiv=
function(){var a=this.elem,b=findPos(a);b[1]+=a.offsetHeight;this.div.style.left=b[0]+"px";this.div.style.top=b[1]+"px"};this.createDiv=function(){var a=document.createElement("ul");for(i in this.eligible){var b=this.eligible[i],d=document.createElement("li"),h=document.createElement("a");h.href="#";h.onclick=function(){return!1};h.innerHTML=b;d.appendChild(h);c.highlighted==i&&(d.className="selected");a.appendChild(d)}this.div.replaceChild(a,this.div.childNodes[0]);a.onmouseover=function(a){for(a=
c.getEventSource(a);a.parentNode&&"LI"!=a.tagName.toUpperCase();)a=a.parentNode;var b=c.div.getElementsByTagName("LI");for(i in b)if(b[i]==a){c.highlighted=i;break}c.changeHighlight()};a.onclick=function(a){c.useSuggestion("click");c.hideDiv();c.cancelEvent(a);return!1};this.div.className="suggestion_list";this.div.style.position="absolute"};this.getEligible=function(){this.eligible=[];if(-1==this.inputText.indexOf(" ")){var a=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions){var b=
this.suggestions[i];b.toLowerCase().match(a)&&(this.eligible[this.eligible.length]=b)}}};this.getKeyCode=function(a){if(a)return a.keyCode;if(window.event)return window.event.keyCode};this.getEventSource=function(a){if(a)return a.target;if(window.event)return window.event.srcElement};this.cancelEvent=function(a){a&&(a.preventDefault(),a.stopPropagation());window.event&&(window.event.returnValue=!1)}}var AutoSuggestIdCounter=0;function isBlank(a){return!a||0===a.length||/^\s*$/.test(a)}
function editdebit(a){var b=$("#qn"+(1*a.id.substr(2)-1));!isBlank(a.value)&&b.hasClass("iscredit")&&(b.is("select")?b.css("margin-right",20):b.width(b.width()+20),b.css("padding-left",0),b.removeClass("iscredit"))}function editcredit(a){var b=$("#qn"+(1*a.id.substr(2)-2));isBlank(a.value)||b.hasClass("iscredit")||(b.is("select")?b.css("margin-right",0):b.width(b.width()-20),b.css("padding-left",20),b.addClass("iscredit"))}
function initcreditboxes(){$(".creditbox").each(function(a,b){if(!isBlank(b.value)&&20!=$(b).css("padding-left")){var c=$("#qn"+(1*b.id.substr(2)-2));c.is("select")?c.css("margin-right",0):c.width(c.width()-20);c.css("padding-left",20);c.addClass("iscredit")}})}initstack.push(initcreditboxes);$(window).on("ImathasEmbedReload",initcreditboxes);
function initqsclickchange(){$("input[id^=qs][value=spec]").each(function(a,b){$(b).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(a){8!=a.keyCode&&46!=a.keyCode&&$(b).prop("checked",!0)})})}$(window).on("ImathasEmbedReload",initqsclickchange);initstack.push(initqsclickchange);
function initShowAnswer(){$("input.sabtn + span.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1);$("input.sabtn").each(function(){var a=$(this).siblings("span:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",a).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("span:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})})}$(window).on("ImathasEmbedReload",initShowAnswer);initstack.push(initShowAnswer);
function assessmentTimer(a,b){var c=Date.now(),d,e,g,f,h;var m=setInterval(function(){d=a-Math.floor((Date.now()-c)/1E3);if(0>=d){d=0;clearInterval(m);if(b){document.getElementById("timelimitholder").className="noticetext";document.getElementById("timelimitholder").innerHTML=_("Time limit expired - submitting now");document.getElementById("timelimitholder").style.fontSize="300%";if(null==document.getElementById("qform")){setTimeout("window.location.href='"+imasroot+"/assessment/showtest.php?action=skip&superdone=true'",
2E3);return}var l=document.getElementById("qform"),n=l.getAttribute("action");l.setAttribute("action",n+"&superdone=true");doonsubmit(l,!0,!0)&&setTimeout('document.getElementById("qform").submit()',2E3);return 0}alert(_("Time Limit has elapsed"))}f=Math.floor(d%60);g=Math.floor(d/60%60);e=Math.floor(d/3600);0==e&&5>g&&(document.getElementById("timeremaining").className="noticetext");0==e&&0==g&&5>=f&&(document.getElementById("timeremaining").style.fontSize="150%");h=(0<e?e+":":"")+(0<e&&10>g?"0":
"")+g+":"+(10>f?"0":"")+f;document.getElementById("timeremaining").innerHTML=h},1E3);$(document).ready(function(){var a=$("#timerwrap"),b=a.position();$(window).scroll(function(){$(window).scrollTop()>=b.top?a.addClass("sticky"):a.removeClass("sticky")})})}
function toggletimer(){"[x]"==$("#timerhide").text()?($("#timercontent").hide(),$("#timerhide").text("["+_("Show Timer")+"]"),$("#timerhide").attr("title","["+_("Show Timer")+"]")):($("#timercontent").show(),$("#timerhide").text("[x]"),$("#timerhide").attr("title",_("Hide Timer")))}
function toggleintroshow(a){var b=document.getElementById("introtoggle"+a);a=document.getElementById("intropiece"+a);b.innerHTML.match("Hide")?(b.innerHTML=b.innerHTML.replace("Hide","Show"),$(b).attr("aria-expanded",!1),a.style.display="none",$(a).attr("aria-hidden",!0).attr("aria-expanded",!1)):(b.innerHTML=b.innerHTML.replace("Show","Hide"),$(b).attr("aria-expanded",!0),a.style.display="block",$(a).attr("aria-hidden",!1).attr("aria-expanded",!0))}
function togglemainintroshow(a){$("#intro").hasClass("hidden")?($(a).html(_("Hide Intro/Instructions")).attr("aria-expanded",!0),$("#intro").removeClass("hidden").addClass("intro").attr("aria-hidden",!1).attr("aria-expanded",!0)):($("#intro").addClass("hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$(a).html(_("Show Intro/Instructions")).attr("aria-expanded",!1))}
function prepWithMath(a){a=a.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(");a=a.replace(/\(E\)/g,"(Math.E)");return a=a.replace(/\((PI|pi)\)/g,"(Math.PI)")}var assessFormIsDirty=[];function trackDirty(){var a=$(this).attr("name").match(/^(qs|qn|tc)(\d+)/);null!==a&&(a=1*a[2],1E3<a&&(a=Math.floor(a/1E3+.001)-1),-1==assessFormIsDirty.indexOf(a)&&assessFormIsDirty.push(a))}
$(function(){$("div.question").find("input,select,textarea").on("change",trackDirty);$(window).on("beforeunload",function(){if(0==$("form.submitted,form.submitted2").length&&0<assessFormIsDirty.length)return _("Are you sure you want to leave this assessment? You may have unsubmitted work")})});

function checkComplete(b){if("undefined"!=typeof tinyMCE)try{tinyMCE.triggerSave()}catch(d){}var c=!0;$(b).find("input:visible,textarea:visible,select:visible").each(function(b,a){if("undefined"==typeof a.type||"undefined"==typeof a.name||""==a.name)return 1;if("text"==a.type||"textarea"==a.type||"password"==a.type||"file"==a.type)""==a.value&&0==$("#qs"+a.id.substr(2)+"-d:checked,#qs"+a.id.substr(2)+"-i:checked").length&&(c=!1);else if(-1!=a.type.indexOf("select")){if(-1==a.selectedIndex||"qn"==
a.name.substr(0,2)&&0==a.selectedIndex)c=!1}else"radio"==a.type&&0==$("input[name="+a.name+"]:checked").length&&(c=!1)});return c}function confirmSubmit(b){return checkComplete(b)?!0:confirm("Not all question parts have been answered.  Are you sure you want to submit this question?")}
function confirmSubmit2(b){return checkComplete(b)?!0:confirm("Not all questions have been answered completely.  If you are saving your answers for later, this is fine.  If you are submitting for grading, are you sure you want to submit now?")};

var canvases=[],drawla=[],imathasDraw=function(v){function ib(a,f){var c=a[0];Ea.push(c);var b=a[1].substr(9).split(","),g=a[2],l=a[3],h=a[4],r=a[5];h==r&&(h=-1,r=1);var k=a[6],H=a[7],w=a[8],v=document.getElementById("a11ydraw"+c);wa[c]=document.getElementById("qn"+c);e[c]={el:v,xmin:g,xmax:l,ymin:h,ymax:r,imgborder:k,imgwidth:H,imgheight:w};e[c].pixperx=(H-2*k)/(l-g);e[c].pixpery=h==r?1:(w-2*k)/(r-h);"inequality"==b[0]?(g=b.shift(),0==b.length?b=["line"]:"both"==b[0]&&(b=["line","parab"])):"twopoint"==
b[0]?(g=b.shift(),0==b.length&&(b=["line","parab","abs","circle","dot"])):"numberline"==b[0]?(g="basic",b.shift()):g="basic";e[c].afgroup=g;l={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),
inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],
parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],sqrt:[{mode:6.5,descr:_("Square root"),inN:2,input:_("Enter the starting point of the square root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],
rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),
inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},
{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},
{mode:9.2,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter list of points to connect with lines")}],
dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:2}]}};h=[];r=[];k=[];for(w=0;w<b.length;w++)if(l[g].hasOwnProperty(b[w])){if(0==
w)var x=l[g][b[w]][0].mode;for(v=0;v<l[g][b[w]].length;v++)k[l[g][b[w]][v].mode]=l[g][b[w]][v],h.push(l[g][b[w]][v].mode),H='<option value="'+l[g][b[w]][v].mode+'"',H+=' data-af="'+b[w]+'">'+l[g][b[w]][v].descr+"</option>",r.push(H)}e[c].defmode=x;e[c].inputmodes=h;e[c].selects=r;e[c].moderef=k;if(null==f&&n.hasOwnProperty(c)){for(w=0;w<n[c].length;w++)Q(c,0,R(n[c][w],c));for(w=0;w<I[c].length;w++)Q(c,1,R(I[c][w],c));for(w=0;w<F[c].length;w++)Q(c,2,R(F[c][w],c));for(w=0;w<d[c].length;w++)Q(c,y[c][w],
R(d[c][w][0],c)+","+R(d[c][w][1],c));for(w=0;w<m[c].length;w++)Q(c,M[c][w],R(m[c][w][0],c)+","+R(m[c][w][1],c)+","+R(m[c][w][2],c))}else if(null!=f)for(w=0;w<f.length;w++)Q(c,f[w][0],f[w][1].replace(/\[/g,"(").replace(/\]/g,")"))}function Q(a,d,c){var b=e[a];d=d||b.defmode;var g=c||"";html='<select aria-label="'+_("Drawing element type")+'" onchange="imathasDraw.changea11ydraw(this,\''+a+"')\">";for(j in b.selects)html+=b.selects[j];html+="</select><br/>";html+='<span class="a11ydrawinstr"></span><br/>';
html+='<input type="text" aria-label="'+_("Point list")+'" value="'+g+'"/>';html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)">';html+=_("Remove")+"</button>";a=v("<li>",{"class":"a11ydrawrow"}).html(html);v(b.el).append(a);a.find("select").val(d);a.find(".a11ydrawinstr").text(b.moderef[d].input);c||a.find("select").focus()}function R(a,d){var c=e[d];var b=(a[0]-c.imgborder)/c.pixperx+c.xmin;c=(c.imgheight-a[1]-c.imgborder)/c.pixpery+c.ymin;b=Math.round(100*
b)/100;c=Math.round(100*c)/100;return"("+b+","+c+")"}function Ab(g,f,c,b,u,l,h,r,k,H,w,x,t,G,A){var D=document.getElementById(f);if(v(D).is(":hidden"))v(D).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",function(){v(D).off("mouseover.imathasdrawwait touchstart.imathasdrawwait");xa(g)});D.style.userSelect="none";D.style.webkitUserSelect="none";D.style.MozUserSelect="none";f=N(D);e[g]={el:D,left:f.x,top:f.y,width:D.offsetWidth,height:D.offsetHeight,xmin:u,xmax:l,ymin:h,ymax:r,imgborder:k,
imgwidth:H,imgheight:w,mode:x,dotline:t};"string"==typeof A&&-1!=A.indexOf(":")?(A=A.split(":"),e[g].snaptogridx=1*A[0],e[g].snaptogridy=1*A[1]):(e[g].snaptogridx=A,e[g].snaptogridy=A);e[g].pixperx=(H-2*k)/(l-u);e[g].pixpery=h==r?1:(w-2*k)/(r-h);wa[g]=document.getElementById(b);null==n[g]&&(n[g]=[]);null==I[g]&&(I[g]=[]);null==F[g]&&(F[g]=[]);null==d[g]&&(d[g]=[]);null==y[g]&&(y[g]=[]);null==m[g]&&(m[g]=[]);null==M[g]&&(M[g]=[]);Na[g]=5<=x?1:0;ja[g]=G;bb[g]=new Image;bb[g].onload=function(){var b=
a;a=g;z();a=b};bb[g].src=c}function z(g,f){try{var c=e[a].el.getContext("2d")}catch(Eb){sb||(sb=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}c.fillStyle="rgb(0,0,255)";c.lineWidth=2;c.strokeStyle="rgb(0,0,255)";c.clearRect(0,0,e[a].imgwidth,e[a].imgheight);c.drawImage(bb[a],0,0);c.beginPath();for(var b=0;b<m[a].length;b++){var u=b%3;c.strokeStyle=
tb[u];c.fillStyle=tb[u];var D=null,h=null,t=null,k=null,H=null;3==m[a][b].length?(h=m[a][b][1][0],k=m[a][b][1][1],t=m[a][b][2][0],H=m[a][b][2][1]):2==m[a][b].length?(h=m[a][b][1][0],k=m[a][b][1][1],t=g,H=f):G==b&&null!=g&&1==m[a][b].length&&(h=g,k=f);if(null!=t){c.save();c.fillStyle=Cb[u];c.beginPath();if(10.2>=M[a][b]){h!=m[a][b][0][0]&&(D=(k-m[a][b][0][1])/(h-m[a][b][0][0]));if(1>Math.abs(h-m[a][b][0][0])||100<Math.abs(D))c.moveTo(m[a][b][0][0],0),c.lineTo(m[a][b][0][0],e[a].imgheight),t>h?(c.lineTo(e[a].imgwidth,
e[a].imgheight),c.lineTo(e[a].imgwidth,0)):(c.lineTo(0,e[a].imgheight),c.lineTo(0,0));else{var w=D*(t-h)+k,z=m[a][b][0][1]-D*m[a][b][0][0],W=m[a][b][0][1]+D*(e[a].imgwidth-m[a][b][0][0]);c.moveTo(0,z);c.lineTo(e[a].imgwidth,W);H>w?(c.lineTo(e[a].imgwidth,e[a].imgheight),c.lineTo(0,e[a].imgheight)):(c.lineTo(e[a].imgwidth,0),c.lineTo(0,0))}c.closePath()}else{var A=c,K=m[a][b][0][0],N=m[a][b][0][1],U=h,R=k,Q=t,fa=H,V=e[a].imgwidth,ha=e[a].imgheight;A.beginPath();if(R==N)A.moveTo(0,R),A.lineTo(V,R),
fa<N?(A.lineTo(V,0),A.lineTo(0,0)):(A.lineTo(V,ha),A.lineTo(0,ha));else{var X=(R-N)/((U-K)*(U-K)),ya=-2*X*K,ra=0;R>N&&(ra=ha);var ia=X*K*K+N-ra,xa=Math.sqrt(ya*ya-4*X*ia);ia+=ra;var ka=(-ya-xa)/(2*X),Fa=X*ka*ka+ya*ka+ia,Ga=(-ya+xa)/(2*X),qa=Fa;if(Ga<ka){var Ma=ka;ka=Ga;Ga=Ma}var sa=2*X*(ka-K),Ba=Fa-sa*ka,Ca=-sa,va=(Ba-(qa-Ca*Ga))/(Ca-sa),Ea=sa*va+Ba;if(0>X&&fa<X*Q*Q+ya*Q+ia||0<X&&fa>X*Q*Q+ya*Q+ia)A.moveTo(ka,Fa),A.quadraticCurveTo(va,Ea,Ga,qa);else{var Da=ha;2>Math.abs(Fa-ha)&&(Da=0);A.moveTo(0,Fa);
A.lineTo(ka,Fa);A.quadraticCurveTo(va,Ea,Ga,qa);A.lineTo(V,qa);A.lineTo(V,Da);A.lineTo(0,Da)}}A.closePath()}c.fill();c.restore()}c.beginPath();if(null!=h)if(10.2>=M[a][b])h!=m[a][b][0][0]&&(D=(k-m[a][b][0][1])/(h-m[a][b][0][0])),1>Math.abs(h-m[a][b][0][0])||100<Math.abs(D)?10.2==M[a][b]?null!=l&&10<=l.mode&&11>l.mode&&l.num==b&&0==l.subnum?(c.dashedLine(m[a][b][1][0],m[a][b][1][1],m[a][b][1][0],e[a].imgheight),c.dashedLine(m[a][b][1][0],m[a][b][1][1],m[a][b][1][0],0)):(c.dashedLine(m[a][b][0][0],
m[a][b][0][1],m[a][b][0][0],e[a].imgheight),c.dashedLine(m[a][b][0][0],m[a][b][0][1],m[a][b][0][0],0)):(c.moveTo(m[a][b][0][0],0),c.lineTo(m[a][b][0][0],e[a].imgheight),c.stroke()):(z=m[a][b][0][1]-D*m[a][b][0][0],W=m[a][b][0][1]+D*(e[a].imgwidth-m[a][b][0][0]),10.2==M[a][b]?null!=l&&10<=l.mode&&11>l.mode&&l.num==b&&0==l.subnum?(c.dashedLine(m[a][b][1][0],m[a][b][1][1],e[a].imgwidth,W),c.dashedLine(m[a][b][1][0],m[a][b][1][1],0,z)):(c.dashedLine(m[a][b][0][0],m[a][b][0][1],e[a].imgwidth,W),c.dashedLine(m[a][b][0][0],
m[a][b][0][1],0,z)):(c.moveTo(0,z),c.lineTo(e[a].imgwidth,W),c.stroke()));else if(10.3==M[a][b]){if(h!=m[a][b][0][0])if(k==m[a][b][0][1])c.moveTo(0,k),c.lineTo(e[a].imgwidth,k);else{var E=(k-m[a][b][0][1])/((h-m[a][b][0][0])*(h-m[a][b][0][0]));if(k>m[a][b][0][1])var L=Math.sqrt((e[a].imgheight-m[a][b][0][1])/E)+m[a][b][0][0],Y=-1*Math.sqrt((e[a].imgheight-m[a][b][0][1])/E)+m[a][b][0][0],Oa=m[a][b][0][1]-(e[a].imgheight-m[a][b][0][1]),Z=e[a].imgheight;else L=Math.sqrt((0-m[a][b][0][1])/E)+m[a][b][0][0],
Y=-1*Math.sqrt((0-m[a][b][0][1])/E)+m[a][b][0][0],Oa=2*m[a][b][0][1],Z=0;var ta=L+2/3*(m[a][b][0][0]-L),ua=Z+2/3*(Oa-Z),Pa=ta+(Y-L)/3,Qa=ua;c.moveTo(L,Z);c.bezierCurveTo(ta,ua,Pa,Qa,Y,Z)}c.stroke()}else if(h!=m[a][b][0][0]){var za=c,na=m[a][b][0][0],Ha=m[a][b][0][1],Na=h,Ia=k,Wa=e[a].imgwidth,gb=e[a].imgheight;if(Ia==Ha)za.moveTo(0,Ia),za.dashedLine(0,Ia,Wa,Ia);else{var aa=(Ia-Ha)/((Na-na)*(Na-na)),Ja=-2*aa*na,jb=0;Ia>Ha&&(jb=gb);var cb=aa*na*na+Ha-jb,Xa=Math.sqrt(Ja*Ja-4*aa*cb);cb+=jb;var db=(-Ja-
Xa)/(2*aa),eb=(-Ja+Xa)/(2*aa);if(eb<db){var hb=db;db=eb;eb=hb}for(var J=na,Aa=Ha,Ra=0;J>db-5&&-5<J;)0==Ra%2?za.moveTo(J,Aa):za.lineTo(J,Aa),J-=Math.min(Math.sqrt(64/(1+Math.pow(2*aa*(J-na),2))),Math.sqrt(8/Math.abs(aa))),Aa=aa*J*J+Ja*J+cb,Ra++;J=na;Aa=Ha;for(Ra=0;J<eb+5&&J<Wa+5;)0==Ra%2?za.moveTo(J,Aa):za.lineTo(J,Aa),J+=Math.min(Math.sqrt(64/(1+Math.pow(2*aa*(J-na),2))),Math.sqrt(8/Math.abs(aa))),Aa=aa*J*J+Ja*J+cb,Ra++}za.stroke()}c.beginPath();for(var B=0;B<m[a][b].length;B++)2==B?(c.arc(m[a][b][B][0],
m[a][b][B][1],4,0,2*Math.PI,!0),c.fill()):c.fillRect(m[a][b][B][0]-3,m[a][b][B][1]-3,6,6);1==m[a][b].length&&null!=h&&c.fillRect(h-3,k-3,6,6);c.beginPath()}c.fillStyle="rgb(0,0,255)";c.lineWidth=1==ja[a]?4:2;c.strokeStyle="rgb(0,0,255)";for(b=0;b<d[a].length;b++){if(5<=y[a][b]&&6>y[a][b]){if(k=h=D=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f),null!=h)if(5.3==y[a][b]||5.4==y[a][b]){if(c.moveTo(d[a][b][0][0],d[a][b][0][1]),c.lineTo(h,k),5.4==y[a][b]){var S=
[h-d[a][b][0][0],k-d[a][b][0][1]];var kb=Math.sqrt(S[0]*S[0]+S[1]*S[1]);if(1E-4<kb){S=[S[0]/kb,S[1]/kb];var fb=[-S[1],S[0]];c.moveTo(h-15*S[0]-4*fb[0],k-15*S[1]-5*fb[1]);c.lineTo(h,k);c.moveTo(h-15*S[0]+4*fb[0],k-15*S[1]+5*fb[1]);c.lineTo(h,k)}}}else h!=d[a][b][0][0]&&(D=(k-d[a][b][0][1])/(h-d[a][b][0][0])),1>Math.abs(h-d[a][b][0][0])||100<Math.abs(D)?5.2==y[a][b]?(c.moveTo(d[a][b][0][0],d[a][b][0][1]),k>d[a][b][0][1]?c.lineTo(d[a][b][0][0],e[a].imgheight):c.lineTo(d[a][b][0][0],0)):(c.moveTo(d[a][b][0][0],
0),c.lineTo(d[a][b][0][0],e[a].imgheight)):(z=d[a][b][0][1]-D*d[a][b][0][0],W=d[a][b][0][1]+D*(e[a].imgwidth-d[a][b][0][0]),z=d[a][b][0][1]-D*d[a][b][0][0],W=d[a][b][0][1]+D*(e[a].imgwidth-d[a][b][0][0]),5.2==y[a][b]?(c.moveTo(d[a][b][0][0],d[a][b][0][1]),h>d[a][b][0][0]?c.lineTo(e[a].imgwidth,W):c.lineTo(0,z)):(c.moveTo(0,z),c.lineTo(e[a].imgwidth,W)))}else if(6==y[a][b]||6.1==y[a][b]){if(h=k=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f),null!=
h)if(6==y[a][b])k==d[a][b][0][1]?(c.moveTo(0,k),c.lineTo(e[a].imgwidth,k)):h==d[a][b][0][0]?(c.moveTo(h,d[a][b][0][1]),k>d[a][b][0][1]?c.lineTo(h,e[a].imgheight):c.lineTo(h,0)):(E=(k-d[a][b][0][1])/((h-d[a][b][0][0])*(h-d[a][b][0][0])),k>d[a][b][0][1]?(L=Math.sqrt((e[a].imgheight-d[a][b][0][1])/E)+d[a][b][0][0],Y=-1*Math.sqrt((e[a].imgheight-d[a][b][0][1])/E)+d[a][b][0][0],Oa=d[a][b][0][1]-(e[a].imgheight-d[a][b][0][1]),Z=e[a].imgheight):(L=Math.sqrt((0-d[a][b][0][1])/E)+d[a][b][0][0],Y=-1*Math.sqrt((0-
d[a][b][0][1])/E)+d[a][b][0][0],Oa=2*d[a][b][0][1],Z=0),ta=L+2/3*(d[a][b][0][0]-L),ua=Z+2/3*(Oa-Z),Pa=ta+(Y-L)/3,Qa=ua,c.moveTo(L,Z),c.bezierCurveTo(ta,ua,Pa,Qa,Y,Z));else if(6.1==y[a][b])if(h==d[a][b][0][0])c.moveTo(h,0),c.lineTo(h,e[a].imgheight);else if(k==d[a][b][0][1])c.moveTo(d[a][b][0][0],k),h>d[a][b][0][0]?c.lineTo(e[a].imgwidth,k):c.lineTo(0,k);else{E=(h-d[a][b][0][0])/((k-d[a][b][0][1])*(k-d[a][b][0][1]));if(h>d[a][b][0][0]){L=Math.sqrt((e[a].imgwidth-d[a][b][0][0])/E)+d[a][b][0][1];Y=-1*
Math.sqrt((e[a].imgwidth-d[a][b][0][0])/E)+d[a][b][0][1];var Ya=d[a][b][0][0]-(e[a].imgwidth-d[a][b][0][0]),Sa=e[a].imgwidth}else L=Math.sqrt((0-d[a][b][0][0])/E)+d[a][b][0][1],Y=-1*Math.sqrt((0-d[a][b][0][0])/E)+d[a][b][0][1],Ya=2*d[a][b][0][0],Sa=0;ua=L+2/3*(d[a][b][0][1]-L);ta=Sa+2/3*(Ya-Sa);Qa=ua+(Y-L)/3;Pa=ta;c.moveTo(Sa,L);c.bezierCurveTo(ta,ua,Pa,Qa,Sa,Y)}}else if(6.5==y[a][b]){if(h=k=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f),null!=
h&&h!=d[a][b][0][0])if(k==d[a][b][0][1])c.moveTo(d[a][b][0][0],k),h>d[a][b][0][0]?c.lineTo(e[a].imgwidth,k):c.lineTo(0,k);else{var lb=h<d[a][b][0][0]?-1:1;E=(k-d[a][b][0][1])/Math.sqrt(lb*(h-d[a][b][0][0]));c.moveTo(d[a][b][0][0],d[a][b][0][1]);p=d[a][b][0][0];q=d[a][b][0][1];do p+=3*lb,c.lineTo(p,E*Math.sqrt(lb*(p-d[a][b][0][0]))+d[a][b][0][1]);while(0<p&&p<e[a].imgwidth&&0<q&&q<e[a].imgheight)}}else if(7<=y[a][b]&&8>y[a][b]){if(h=k=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&
null!=g&&1==d[a][b].length&&(h=g,k=f),null!=h&&(h!=d[a][b][0][0]||k!=d[a][b][0][1]))if(7==y[a][b])c.arc(d[a][b][0][0],d[a][b][0][1],Math.sqrt((h-d[a][b][0][0])*(h-d[a][b][0][0])+(k-d[a][b][0][1])*(k-d[a][b][0][1])),0,2*Math.PI,!0);else if(7.2==y[a][b]){var Za=Math.abs(h-d[a][b][0][0]),$a=Math.abs(k-d[a][b][0][1]);if(x==b||null!=l&&l.num==b)c.strokeStyle="rgb(0,255,255)",c.lineWidth=1,c.dashedLine(h,k,h-2*(h-d[a][b][0][0]),k,5),c.dashedLine(h,k,h,k-2*(k-d[a][b][0][1]),5),c.dashedLine(h,k-2*(k-d[a][b][0][1]),
h-2*(h-d[a][b][0][0]),k-2*(k-d[a][b][0][1]),5),c.dashedLine(h-2*(h-d[a][b][0][0]),k,h-2*(h-d[a][b][0][0]),k-2*(k-d[a][b][0][1]),5),c.lineWidth=2;c.strokeStyle="rgb(0,0,255)";c.save();c.beginPath();c.translate(d[a][b][0][0]-Za,d[a][b][0][1]-$a);c.scale(Za,$a);c.arc(1,1,1,0,2*Math.PI,!1);c.restore()}else if(7.4==y[a][b]){var ba=Math.abs(h-d[a][b][0][0]),ca=Math.abs(k-d[a][b][0][1]),oa=Math.abs(ca/ba);c.strokeStyle="rgb(0,200,0)";c.dashedLine(d[a][b][0][0],d[a][b][0][1],e[a].imgwidth,d[a][b][0][1]+oa*
(e[a].imgwidth-d[a][b][0][0]));c.dashedLine(d[a][b][0][0],d[a][b][0][1],e[a].imgwidth,d[a][b][0][1]-oa*(e[a].imgwidth-d[a][b][0][0]));c.dashedLine(d[a][b][0][0],d[a][b][0][1],0,d[a][b][0][1]-oa*d[a][b][0][0]);c.dashedLine(d[a][b][0][0],d[a][b][0][1],0,d[a][b][0][1]+oa*d[a][b][0][0]);if(x==b||null!=l&&l.num==b)c.strokeStyle="rgb(0,255,255)",c.lineWidth=1,c.dashedLine(h,k,h-2*(h-d[a][b][0][0]),k,5),c.dashedLine(h,k,h,k-2*(k-d[a][b][0][1]),5),c.dashedLine(h,k-2*(k-d[a][b][0][1]),h-2*(h-d[a][b][0][0]),
k-2*(k-d[a][b][0][1]),5),c.dashedLine(h-2*(h-d[a][b][0][0]),k,h-2*(h-d[a][b][0][0]),k-2*(k-d[a][b][0][1]),5),c.lineWidth=2;c.beginPath();c.strokeStyle="rgb(0,0,255)";for(var p=0;p<e[a].imgwidth+4;p+=3)q=d[a][b][0][1]+Math.sqrt((Math.pow(p-d[a][b][0][0],2)/(ba*ba)+1)*ca*ca),-100>q&&(q=-100),q>e[a].imgheight+100&&(q=e[a].imgheight+100),0==p?c.moveTo(p,q):c.lineTo(p,q);c.stroke();c.beginPath();for(p=0;p<e[a].imgwidth+4;p+=3)q=d[a][b][0][1]-Math.sqrt((Math.pow(p-d[a][b][0][0],2)/(ba*ba)+1)*ca*ca),-100>
q&&(q=-100),q>e[a].imgheight+100&&(q=e[a].imgheight+100),0==p?c.moveTo(p,q):c.lineTo(p,q)}else if(7.5==y[a][b]){ca=Math.abs(h-d[a][b][0][0]);ba=Math.abs(k-d[a][b][0][1]);oa=Math.abs(ba/ca);c.strokeStyle="rgb(0,200,0)";c.dashedLine(d[a][b][0][0],d[a][b][0][1],e[a].imgwidth,d[a][b][0][1]+oa*(e[a].imgwidth-d[a][b][0][0]));c.dashedLine(d[a][b][0][0],d[a][b][0][1],e[a].imgwidth,d[a][b][0][1]-oa*(e[a].imgwidth-d[a][b][0][0]));c.dashedLine(d[a][b][0][0],d[a][b][0][1],0,d[a][b][0][1]-oa*d[a][b][0][0]);c.dashedLine(d[a][b][0][0],
d[a][b][0][1],0,d[a][b][0][1]+oa*d[a][b][0][0]);if(x==b||null!=l&&l.num==b)c.strokeStyle="rgb(0,255,255)",c.lineWidth=1,c.dashedLine(h,k,h-2*(h-d[a][b][0][0]),k,5),c.dashedLine(h,k,h,k-2*(k-d[a][b][0][1]),5),c.dashedLine(h,k-2*(k-d[a][b][0][1]),h-2*(h-d[a][b][0][0]),k-2*(k-d[a][b][0][1]),5),c.dashedLine(h-2*(h-d[a][b][0][0]),k,h-2*(h-d[a][b][0][0]),k-2*(k-d[a][b][0][1]),5),c.lineWidth=2;c.beginPath();c.strokeStyle="rgb(0,0,255)";for(var q=0;q<e[a].imgwidth+4;q+=3)p=d[a][b][0][0]+Math.sqrt((Math.pow(q-
d[a][b][0][1],2)/(ba*ba)+1)*ca*ca),-100>p&&(p=-100),p>e[a].imgwidth+100&&(p=e[a].imgwidth+100),0==q?c.moveTo(p,q):c.lineTo(p,q);c.stroke();c.beginPath();for(q=0;q<e[a].imgwidth+4;q+=3)p=d[a][b][0][0]-Math.sqrt((Math.pow(q-d[a][b][0][1],2)/(ba*ba)+1)*ca*ca),-100>p&&(p=-100),p>e[a].imgwidth+100&&(p=e[a].imgwidth+100),0==q?c.moveTo(p,q):c.lineTo(p,q)}}else if(8==y[a][b])k=h=D=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f),null!=h&&(h!=d[a][b][0][0]&&
(D=(k-d[a][b][0][1])/(h-d[a][b][0][0]),h<d[a][b][0][0]&&(D*=-1)),1>Math.abs(h-d[a][b][0][0])||100<Math.abs(D)?(c.moveTo(d[a][b][0][0],d[a][b][0][1]),k>d[a][b][0][1]?c.lineTo(d[a][b][0][0],e[a].imgheight):c.lineTo(d[a][b][0][0],0)):(z=d[a][b][0][1]+D*d[a][b][0][0],W=d[a][b][0][1]+D*(e[a].imgwidth-d[a][b][0][0]),c.moveTo(0,z),c.lineTo(d[a][b][0][0],d[a][b][0][1]),c.lineTo(e[a].imgwidth,W)));else if(8.3==y[a][b]){if(h=k=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&
(h=g,k=f),null!=h&&h!=d[a][b][0][0])if(k==d[a][b][0][1])c.moveTo(0,k),c.lineTo(e[a].imgwidth,k);else{var mb=e[a].ymax*e[a].pixpery+e[a].imgborder,ab=mb-d[a][b][0][1],Ka=mb-k;if(0<ab*Ka&&h!=d[a][b][0][0]){var da=safepow(Ka/ab,1/(h-d[a][b][0][0]));E=Ka/safepow(da,h);c.moveTo(d[a][b][0][0],d[a][b][0][1]);for(p=q=0;p<e[a].imgwidth+4;p+=3)q=mb-E*safepow(da,p),-100>q&&(q=-100),q>e[a].imgheight+100&&(q=e[a].imgheight+100),0==p?c.moveTo(p,q):c.lineTo(p,q)}}}else if(8.4==y[a][b]){if(h=k=null,2==d[a][b].length?
(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f),null!=h&&h!=d[a][b][0][0]&&k!=d[a][b][0][1]){var nb=-e[a].xmin*e[a].pixperx+e[a].imgborder,ub=nb-d[a][b][0][0],La=nb-h;if(0<ub*La&&k!=d[a][b][0][1])for(da=safepow(La/ub,1/(k-d[a][b][0][1])),E=La/safepow(da,k),c.moveTo(d[a][b][0][0],d[a][b][0][1]),q=q=0;q<e[a].imgheight+4;q+=3)p=nb-E*safepow(da,q),-100>p&&(p=-100),p>e[a].imgwidth+100&&(p=e[a].imgwidth+100),0==q?c.moveTo(p,q):c.lineTo(p,q)}}else if(8.5==y[a][b]){t=H=h=k=null;
3==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1],t=d[a][b][2][0],H=d[a][b][2][1]):2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1],t=g,H=f):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f);var Ta=d[a][b][0][1];c.strokeStyle="rgb(0,200,0)";c.dashedLine(5,Ta,e[a].imgwidth,Ta);c.beginPath();c.strokeStyle="rgb(0,0,255)";if(null!=t&&t!=h)if(H==k)c.moveTo(0,H),c.lineTo(e[a].imgwidth,H);else{Ka=Ta-k;var ob=Ta-H;if(0<Ka*ob&&t!=h)for(da=safepow(ob/Ka,1/(t-h)),E=ob/safepow(da,t),c.moveTo(h,k),p=q=0;p<e[a].imgwidth+
4;p+=3)q=Ta-E*safepow(da,p),-100>q&&(q=-100),q>e[a].imgheight+100&&(q=e[a].imgheight+100),0==p?c.moveTo(p,q):c.lineTo(p,q)}}else if(8.6==y[a][b]){t=H=h=k=null;3==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1],t=d[a][b][2][0],H=d[a][b][2][1]):2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1],t=g,H=f):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f);var Ua=d[a][b][0][0];c.strokeStyle="rgb(0,200,0)";c.dashedLine(Ua,5,Ua,e[a].imgheight);c.beginPath();c.strokeStyle="rgb(0,0,255)";if(null!=t&&t!=h&&H!=k){La=
h-Ua;var pb=t-Ua;if(0<La*pb)for(da=safepow(pb/La,1/(H-k)),E=pb/safepow(da,H),c.moveTo(h,k),q=p=0;q<e[a].imgheight+4;q+=3)p=Ua+E*safepow(da,q),-100>p&&(p=-100),p>e[a].imgwidth+100&&(p=e[a].imgwidth+100),0==q?c.moveTo(p,q):c.lineTo(p,q)}}else if(8.2==y[a][b]){if(h=k=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f),c.strokeStyle="rgb(0,200,0)",c.dashedLine(5,d[a][b][0][1],e[a].imgwidth,d[a][b][0][1]),c.dashedLine(d[a][b][0][0],5,d[a][b][0][0],e[a].imgheight),
c.beginPath(),c.strokeStyle="rgb(0,0,255)",null!=h&&h!=d[a][b][0][0]&&k!=d[a][b][0][1]){E=(k-d[a][b][0][1])*(h-d[a][b][0][0]);for(p=d[a][b][0][0]-1;-4<p;p-=3)q=E/(p-d[a][b][0][0])+d[a][b][0][1],-100>q&&(q=-100),q>e[a].imgheight+100&&(q=e[a].imgheight+100),p==d[a][b][0][0]-1?c.moveTo(p,q):c.lineTo(p,q);for(p=d[a][b][0][0]+1;p<e[a].imgwidth+4;p+=3)q=E/(p-d[a][b][0][0])+d[a][b][0][1],-100>q&&(q=-100),q>e[a].imgheight+100&&(q=e[a].imgheight+100),p==d[a][b][0][0]+1?c.moveTo(p,q):c.lineTo(p,q);c.stroke()}}else if(9==
y[a][b]||9.1==y[a][b])if(h=k=null,2==d[a][b].length?(h=d[a][b][1][0],k=d[a][b][1][1]):x==b&&null!=g&&1==d[a][b].length&&(h=g,k=f),null!=h&&h!=d[a][b][0][0])if(k==d[a][b][0][1])c.moveTo(0,k),c.lineTo(e[a].imgwidth,k);else{if(9==y[a][b]){var vb=-1*Math.abs(k-d[a][b][0][1])/2,wb=(k+d[a][b][0][1])/2;E=Math.PI/Math.abs(h-d[a][b][0][0]);var xb=k<d[a][b][0][1]?h:d[a][b][0][0]}else 9.1==y[a][b]&&(vb=-1*Math.abs(k-d[a][b][0][1]),wb=d[a][b][0][1],E=.5*Math.PI/Math.abs(h-d[a][b][0][0]),xb=k<d[a][b][0][1]?h:
h+2*Math.abs(h-d[a][b][0][0]));for(p=q=0;p<e[a].imgwidth+4;p+=3)q=vb*Math.cos(E*(p-xb))+wb,0==p?c.moveTo(p,q):c.lineTo(p,q)}c.stroke();c.beginPath()}if(null===x&&qb.hasOwnProperty(e[a].mode)){c.strokeStyle="rgb(200,200,200)";if(8.5==e[a].mode)c.dashedLine(5,f,e[a].imgwidth,f);else if(8.6==e[a].mode)c.dashedLine(g,5,g,e[a].imgwidth);else if(8.2==e[a].mode)c.dashedLine(5,f,e[a].imgwidth,f),c.dashedLine(g,5,g,e[a].imgheight);else if(7.4==e[a].mode||7.5==e[a].mode)c.dashedLine(g,f,e[a].imgwidth,f+(e[a].imgwidth-
g)),c.dashedLine(g,f,e[a].imgwidth,f-(e[a].imgwidth-g)),c.dashedLine(g,f,0,f-g),c.dashedLine(g,f,0,f+g);c.beginPath();c.strokeStyle="rgb(0,0,255)"}c.fillStyle="rgba(0,0,255,.5)";for(b=0;b<n[a].length;b++){c.beginPath();for(B=0;B<n[a][b].length;B++)if(0==B){c.moveTo(n[a][b][B][0],n[a][b][B][1]);var ea=n[a][b][B][0];var pa=n[a][b][B][1]}else{c.lineTo(n[a][b][B][0],n[a][b][B][1]);var T=n[a][b][B][0];var la=n[a][b][B][1]}b==r&&null!=g&&(c.lineTo(g,f),T=g,la=f);var O=.02*e[a].imgwidth;1==ja[a]&&T>.98*
e[a].imgwidth?(c.moveTo(T,la),c.lineTo(T-O,la+O),c.moveTo(T,la),c.lineTo(T-O,la-O)):1==ja[a]&&ea>.98*e[a].imgwidth&&(c.moveTo(ea,pa),c.lineTo(ea-O,pa+O),c.moveTo(ea,pa),c.lineTo(ea-O,pa-O));1==ja[a]&&T<.02*e[a].imgwidth?(c.moveTo(T,la),c.lineTo(T+O,la+O),c.moveTo(T,la),c.lineTo(T+O,la-O)):1==ja[a]&&ea<.02*e[a].imgwidth&&(c.moveTo(ea,pa),c.lineTo(ea+O,pa+O),c.moveTo(ea,pa),c.lineTo(ea+O,pa-O));c.stroke();if(1<e[a].dotline&&!(1>n[a][b].length-1)&&25>Math.pow(T-ea,2)+Math.pow(la-pa,2)){c.moveTo(n[a][b][0][0],
n[a][b][0][1]);for(B=1;B<n[a][b].length;B++)c.lineTo(n[a][b][B][0],n[a][b][B][1]);c.closePath();c.fill()}}c.fillStyle="rgb(0,0,255)";c.beginPath();for(b=0;b<I[a].length;b++)c.moveTo(I[a][b][0]+5,I[a][b][1]),c.arc(I[a][b][0],I[a][b][1],5,0,2*Math.PI,!0);c.fill();if(0<e[a].dotline){c.beginPath();for(b=0;b<n[a].length;b++)for(B=0;B<n[a][b].length;B++)if(0==B||25<Math.pow(n[a][b][B][0]-n[a][b][B-1][0],2)+Math.pow(n[a][b][B][1]-n[a][b][B-1][1],2))c.moveTo(n[a][b][B][0]+5,n[a][b][B][1]),c.arc(n[a][b][B][0],
n[a][b][B][1],5,0,2*Math.PI,!0);c.fill()}c.fillStyle="rgb(255,255,255)";c.beginPath();for(b=0;b<F[a].length;b++)c.moveTo(F[a][b][0]+5,F[a][b][1]),c.arc(F[a][b][0],F[a][b][1],4,0,2*Math.PI,!0);3>e[a].mode?c.fill():c.stroke();c.lineWidth=2;c.beginPath();for(b=0;b<F[a].length;b++)c.moveTo(F[a][b][0]+5,F[a][b][1]),c.arc(F[a][b][0],F[a][b][1],4,0,2*Math.PI,!0);c.stroke();for(b=0;b<d[a].length;b++)if(y[a][b]==e[a].mode){c.fillStyle="rgb(255,0,0)";for(B=0;B<d[a][b].length;B++)c.fillRect(d[a][b][B][0]-3,
d[a][b][B][1]-3,6,6);d[a][b].length<Va[e[a].mode]&&null!=g&&x==b&&c.fillRect(g-3,f-3,6,6);c.fillStyle="rgb(0,0,255)"}for(var P="",C=0;C<n[a].length;C++){0!=C&&(P+=";");for(var ma=0;ma<n[a][C].length;ma++)0!=ma&&(P+=","),P+="("+n[a][C][ma][0]+","+n[a][C][ma][1]+")"}P+=";;";for(C=0;C<I[a].length;C++)0!=C&&(P+=","),P+="("+I[a][C][0]+","+I[a][C][1]+")";P+=";;";for(C=0;C<F[a].length;C++)0!=C&&(P+=","),P+="("+F[a][C][0]+","+F[a][C][1]+")";P+=";;";var yb=[],rb="";for(C=0;C<d[a].length;C++)if(d[a][C].length==
Va[y[a][C]]){rb="("+y[a][C];for(ma=0;ma<d[a][C].length;ma++)rb+=","+d[a][C][ma][0]+","+d[a][C][ma][1];yb.push(rb+")")}P+=yb.join(",");P+=";;";var zb=[];for(C=0;C<m[a].length;C++)2<m[a][C].length&&zb.push("("+M[a][C]+","+m[a][C][0][0]+","+m[a][C][0][1]+","+m[a][C][1][0]+","+m[a][C][1][1]+","+m[a][C][2][0]+","+m[a][C][2][1]+")");P+=zb.join(",");if(wa[a].value!=P){var ib=""!=wa[a].value||";;;;;;;;"!=P;wa[a].value=P;ib&&v(wa[a]).trigger("change")}}function fa(g){Db++;qa();if(K&&1<g.originalEvent.touches.length)return ha=
!0,v(document).on("touchend.imathasdraw",Ma),!0;K?(window.clearTimeout(Wa),v(document).off("mousemove.imathasdraw"),v(".drawcanvas").on("touchstart.imathasdraw",function(a){K=!0;fa(a)}),v(".drawcanvas").on("touchmove.imathasdraw",ra),v(document).on("touchend.imathasdraw",Ma),v(document).on("touchcancel.imathasdraw",Ma)):(v(document).on("mousemove.imathasdraw",ra),v(document).on("mouseup.imathasdraw",Ma));var f=sa(g);if(null==a||null==r&&null==x&&null==G)for(i in e){var c=N(e[i].el);if(c.x<f.x&&c.x+
e[i].width>f.x&&c.y<f.y&&c.y+e[i].height>f.y){a=i;break}}null!=a&&(g.preventDefault(),U=!0,c=N(e[a].el),g={x:f.x-c.x,y:f.y-c.y},-1<g.x&&g.x<e[a].width&&-1<g.y&&g.y<e[a].height?(0<e[a].snaptogridx&&(g=Ba(g,a)),1==ja[a]&&(g.y=e[a].imgheight/2),f=ia(a,g),null!=f&&(null!=r&&1>f[0]&&r!=f[1]?f=null:null!=x&5<=f[0]&&10>f[0]&&x!=f[1]?f=null:null!=G&&10<=f[0]&&11>f[0]&&G!=f[1]&&(f=null)),null==f?(A("pendown"),1==e[a].mode?(I[a].push([g.x,g.y]),l={mode:1,num:I[a].length-1}):2==e[a].mode?(F[a].push([g.x,g.y]),
l={mode:2,num:F[a].length-1}):0==e[a].mode||.7==e[a].mode?null==r?(n[a].push([[g.x,g.y]]),r=n[a].length-1):n[a][r].push([g.x,g.y]):.5==e[a].mode?null==r?(n[a].push([[g.x,g.y]]),r=n[a].length-1):(n[a][r].push([g.x,g.y]),l=r=null):5<=e[a].mode&&10>e[a].mode?null==x?(d[a].push([[g.x,g.y]]),x=d[a].length-1,y[a][x]=e[a].mode,U=!1):(d[a][x].push([g.x,g.y]),d[a][x].length==Va[e[a].mode]&&(l={mode:e[a].mode,num:x,subnum:1},x=null)):10<=e[a].mode&&11>e[a].mode&&(null==G?(m[a].push([[g.x,g.y]]),G=m[a].length-
1,M[a][G]=e[a].mode,U=!1):(m[a][G].push([g.x,g.y]),2==m[a][G].length?l={mode:e[a].mode,num:G,subnum:1}:3==m[a][G].length&&(l={mode:e[a].mode,num:G,subnum:2},G=null)))):(0==f[0]||.5==f[0]?null==r?(A("move"),l={mode:e[a].mode,num:f[1],subnum:f[2]},Ca=n[a][f[1]][f[2]],f[2]==n[a][f[1]].length-1&&0==e[a].mode?r=f[1]:0==f[2]&&0==e[a].mode&&(r=f[1],n[a][r].reverse(),l.subnum=n[a][r].length-1)):f[1]==r&&f[2]==n[a][f[1]].length-1?(2>n[a][r].length&&n[a].splice(r,1),r=null):1<e[a].dotline&&f[1]==r&&0==f[2]?
(n[a][r].push(n[a][r][0]),r=null):(A("pendown"),n[a][r].push([g.x,g.y])):1==f[0]?(A("move"),l={mode:1,num:f[1]}):2==f[0]?(A("move"),l={mode:2,num:f[1]}):5<=f[0]&&10>f[0]?(A("move"),l={mode:f[0],num:f[1],subnum:f[2]},Ca=d[a][f[1]][f[2]]):10<=f[0]&&11>f[0]&&(A("move"),l={mode:f[0],num:f[1],subnum:f[2]},Ca=m[a][f[1]][f[2]]),Da=!0),z()):(null!=r&&(2>n[a][r].length&&n[a].splice(r,1),A("pen")),null!=x&&(d[a][x].length<Va[e[a].mode]&&d[a].splice(x,1),A("pen")),null!=G&&(3>m[a][G].length&&m[a].splice(G,1),
A("pen")),l=G=x=r=null,z(),a=null))}function ia(a,f){if(K){var c=Math.max(15*window.innerWidth/screen.width,15);c*=c}else c=25;if(0==Na[a])if(0==e[a].mode||.5==e[a].mode)for(var b=0;b<n[a].length;b++)for(var g=n[a][b].length-1;0<=g;g--){var l=Math.pow(n[a][b][g][0]-f.x,2)+Math.pow(n[a][b][g][1]-f.y,2);if(l<c)return[e[a].mode,b,g]}else if(1==e[a].mode)for(b=0;b<I[a].length;b++){if(Math.pow(I[a][b][0]-f.x,2)+Math.pow(I[a][b][1]-f.y,2)<c)return[1,b]}else if(2==e[a].mode)for(b=0;b<F[a].length;b++){if(Math.pow(F[a][b][0]-
f.x,2)+Math.pow(F[a][b][1]-f.y,2)<c)return[2,b]}else if(5<=e[a].mode&&10>e[a].mode)for(b=0;b<d[a].length;b++){if(y[a][b]==e[a].mode)for(g=d[a][b].length-1;0<=g;g--)if(l=Math.pow(d[a][b][g][0]-f.x,2)+Math.pow(d[a][b][g][1]-f.y,2),l<c)return[y[a][b],b,g]}else{if(10<=e[a].mode&&11>e[a].mode)for(b=0;b<m[a].length;b++)for(g=m[a][b].length-1;0<=g;g--)if(l=Math.pow(m[a][b][g][0]-f.x,2)+Math.pow(m[a][b][g][1]-f.y,2),l<c)return[M[a][b],b,g]}else if(1==e[a].mode)for(b=0;b<I[a].length;b++){if(Math.pow(I[a][b][0]-
f.x,2)+Math.pow(I[a][b][1]-f.y,2)<c)return[1,b]}else if(2==e[a].mode)for(b=0;b<F[a].length;b++){if(Math.pow(F[a][b][0]-f.x,2)+Math.pow(F[a][b][1]-f.y,2)<c)return[2,b]}else if(5<=e[a].mode&&10>e[a].mode)for(b=0;b<d[a].length;b++)for(g=d[a][b].length-1;0<=g;g--){if(y[a][b]==e[a].mode&&(l=Math.pow(d[a][b][g][0]-f.x,2)+Math.pow(d[a][b][g][1]-f.y,2),l<c))return[y[a][b],b,g]}else if(10<=e[a].mode&&11>e[a].mode)for(b=0;b<m[a].length;b++)for(g=m[a][b].length-1;0<=g;g--)if(l=Math.pow(m[a][b][g][0]-f.x,2)+
Math.pow(m[a][b][g][1]-f.y,2),l<c)return[M[a][b],b,g];return null}function Ma(g){var f=sa(g);U=!1;if(null!=a){var c=N(e[a].el),b={x:f.x-c.x,y:f.y-c.y};0<e[a].snaptogridx&&(b=Ba(b,a));c=-1<b.x&&b.x<e[a].width&&-1<b.y&&b.y<e[a].height;1==Da&&(5<=e[a].mode&&10>e[a].mode?(d[a].push([[b.x,b.y]]),x=d[a].length-1,y[a][x]=e[a].mode):10<=e[a].mode&&11>e[a].mode&&(m[a].push([[b.x,b.y]]),G=m[a].length-1,M[a][G]=e[a].mode));null!=va&&f.x==va.x&&f.y==va.y&&null!=r&&null==l&&(2>n[a][r].length&&n[a].splice(r,1),
l=r=null,z());null!=r&&null==l&&(.5==e[a].mode&&1<n[a][r].length?(dragobj=r=null,z()):.7==e[a].mode&&(dragobj=r=null,z()));null!=x&&1==d[a][x].length&&(ha||!c?(d[a].splice(x,1),x=null,z()):null==ia(a,b)&&(d[a][x].push([b.x,b.y]),x=null,z()));null!=G&&1==m[a][G].length&&(ha||!c?(m[a].splice(G,1),G=null,z()):null==ia(a,b)&&(m[a][G].push([b.x,b.y]),z()));null==r&&null==x?A("move"):A("pen");"undefined"!=typeof g&&g.preventDefault()}va=f;null!=a&&null!=l&&(c=N(e[a].el),-1<b.x&&b.x<e[a].width&&-1<b.y&&
b.y<e[a].height?(0==l.mode&&1<e[a].dotline&&(0==l.subnum||l.subnum==n[a][l.num].length-1)&&25>Math.pow(n[a][l.num][0][0]-n[a][l.num][n[a][l.num].length-1][0],2)+Math.pow(n[a][l.num][0][1]-n[a][l.num][n[a][l.num].length-1][1],2)&&(0==l.subnum?(n[a][l.num][n[a][l.num].length-1][0]=n[a][l.num][0][0],n[a][l.num][n[a][l.num].length-1][1]=n[a][l.num][0][1]):(n[a][l.num][0][0]=n[a][l.num][n[a][l.num].length-1][0],n[a][l.num][0][1]=n[a][l.num][n[a][l.num].length-1][1]),r=null,z()),l=null):(1==ja[a]&&(b.y=
e[a].imgheight/2),1==l.mode?I[a].splice(l.num,1):2==l.mode?F[a].splice(l.num,1):.5==l.mode?n[a].splice(l.num,1):0==l.mode?n[a][l.num][l.subnum]=Ca:5<=l.mode&&10>l.mode?(d[a].splice(l.num,1),x=null):10<=l.mode&&11>l.mode&&(m[a].splice(l.num,1),G=null),l=null,z()));ha=!1;K?Wa=window.setTimeout(function(){K=!1;qa();v(document).on("mousemove.imathasdraw",ra);v(".drawcanvas").on("touchstart.imathasdraw",function(a){K=!0;fa(a)});v(document).on("mousedown.imathasdraw",fa)},350):(qa(),v(document).on("mousemove.imathasdraw",
ra),v(".drawcanvas").on("touchstart.imathasdraw",function(a){K=!0;fa(a)}),v(document).on("mousedown.imathasdraw",fa))}function ra(g){var f=null;Da=!1;var c=sa(g);for(i in e){var b=N(e[i].el);if(b.x<c.x&&b.x+e[i].width>c.x&&b.y<c.y&&b.y+e[i].height>c.y){f=i;break}}if(null!=f){V=f;b=N(e[f].el);var u={x:c.x-b.x,y:c.y-b.y};0<e[f].snaptogridx&&(u=Ba(u,f));1==ja[f]&&(u.y=e[f].imgheight/2);-1<u.x&&u.x<e[f].width&&-1<u.y&&u.y<e[f].height&&null==l&&null==r&&(b=ia(f,u),null==b?A("pen",f):A("move",f))}else null!=
V&&-1!=V&&(null!=a?z():(a=V,z(),a=null),V=-1);if(null!=a){if(g.originalEvent.touches&&1<g.originalEvent.touches.length)return ha=!0;"undefined"!=typeof g&&g.preventDefault();b=N(e[a].el);u={x:c.x-b.x,y:c.y-b.y};0<e[a].snaptogridx&&(u=Ba(u,a));1==ja[a]&&(u.y=e[a].imgheight/2);if(-1<u.x&&u.x<e[a].width&&-1<u.y&&u.y<e[a].height)return null==l?null!=r?!U||0!=e[a].mode&&.7!=e[a].mode?U&&.5==e[a].mode?(g=n[a][r].length-1,0==g?(g=Math.pow(n[a][r][g][0]-u.x,2)+Math.pow(n[a][r][g][1]-u.y,2),25<g?(n[a][r].push([u.x,
u.y]),z()):z(u.x,u.y)):(n[a][r][g]=[u.x,u.y],z())):z(u.x,u.y):(g=n[a][r].length-1,g=Math.pow(n[a][r][g][0]-u.x,2)+Math.pow(n[a][r][g][1]-u.y,2),25<g?(n[a][r].push([u.x,u.y]),z()):z(u.x,u.y)):null!=x?U?z():z(u.x,u.y):null!=G?U?z():z(u.x,u.y):(b=ia(a,u),null==b?(A("pen"),qb.hasOwnProperty(e[a].mode)&&null!==f&&z(u.x,u.y)):(z(),A("move"))):(A("move"),0==l.mode||.5==l.mode?n[a][l.num][l.subnum]=[u.x,u.y]:1==l.mode?I[a][l.num]=[u.x,u.y]:2==l.mode?F[a][l.num]=[u.x,u.y]:5<=l.mode&&10>l.mode?d[a][l.num][l.subnum]=
[u.x,u.y]:10<=l.mode&&11>l.mode&&(m[a][l.num][l.subnum]=[u.x,u.y]),z()),!1;null==G||U||z()}else null!=f&&-1!=V&&(a=f,qb.hasOwnProperty(e[a].mode)&&z(u.x,u.y),a=null)}function A(d,f){f=f||a;e[f].cursor!=d&&(e[f].el.style.cursor="move"==d?d:"url("+imasroot+"/img/"+d+".cur), auto",e[f].cursor=d)}function sa(a){a=a||window.event;if(K)return a=a.originalEvent.changedTouches[0]||a.originalEvent.touches[0],{x:a.pageX,y:a.pageY};if(a.pageX||a.pageY)return{x:a.pageX,y:a.pageY};var d=document.documentElement,
c=document.body;if(d&&(d.scrollTop||d.scrollLeft)){var b=d.scrollLeft;d=d.scrollTop}else c?(b=c.scrollLeft,d=c.scrollTop):d=b=0;return{x:a.clientX+b,y:a.clientY+d}}function Ba(a,d){var c=a.x-e[d].imgborder+e[d].xmin*e[d].pixperx,b=a.y-e[d].imgborder-e[d].ymax*e[d].pixpery;c=Math.round(Math.round(c/(e[d].pixperx*e[d].snaptogridx))*e[d].pixperx*e[d].snaptogridx+e[d].imgborder-e[d].xmin*e[d].pixperx);b=Math.round(Math.round(b/(e[d].pixpery*e[d].snaptogridy))*e[d].pixpery*e[d].snaptogridy+e[d].imgborder+
e[d].ymax*e[d].pixpery);return{x:c,y:b}}function gb(a,d){var c=N(a),b=sa(d);return{x:b.x-c.x,y:b.y-c.y}}function N(a){var d=0,c=0;if(a.className.match(/hidden/))return{x:-1E4,y:-1E4};for(;a.offsetParent;)if(d+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent,a.className.match(/hidden/))return{x:-1E4,y:-1E4};d+=a.offsetLeft;c+=a.offsetTop;return{x:d,y:c}}function qa(){v(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw");v(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw");
v(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function xa(g){qa();v(document).on("mousemove.imathasdraw",ra);v(".drawcanvas").on("touchstart.imathasdraw",function(a){K=!0;fa(a)});v(document).on("mousedown.imathasdraw",fa);try{CanvasRenderingContext2D.prototype.dashedLine=function(b,c,d,g,f){void 0==f&&(f=10);this.beginPath();this.moveTo(b,c);var h=d-b,k=g-c;f=Math.sqrt(h*h+k*k)/f;h/=f;k/=f;f=Math.floor(f);for(var l=
0;l++<f&&-1<c&&c<e[a].imgheight+1&&-1<b&&b<e[a].imgwidth+1;)b+=h,c+=k,this[0==l%2?"moveTo":"lineTo"](b,c);this[0==l%2?"moveTo":"lineTo"](d,g);this.stroke();this.closePath()}}catch(D){}for(var f in canvases)if("undefined"==typeof g||g==f){var c=null;if(null!=drawla[f]&&2<drawla[f].length){n[canvases[f][0]]=drawla[f][0];I[canvases[f][0]]=drawla[f][1];F[canvases[f][0]]=drawla[f][2];y[canvases[f][0]]=[];d[canvases[f][0]]=[];if(3<drawla[f].length&&0<drawla[f][3].length)for(var b=0;b<drawla[f][3].length;b++){y[canvases[f][0]][b]=
drawla[f][3][b][0];d[canvases[f][0]][b]=[];for(var l=0;l<Va[y[canvases[f][0]][b]];l++)d[canvases[f][0]][b].push(drawla[f][3][b].slice(1+2*l,3+2*l))}M[canvases[f][0]]=[];m[canvases[f][0]]=[];if(4<drawla[f].length&&0<drawla[f][4].length)for(b=0;b<drawla[f][4].length;b++)M[canvases[f][0]][b]=drawla[f][4][b][0],m[canvases[f][0]][b]=[drawla[f][4][b].slice(1,3),drawla[f][4][b].slice(3,5),drawla[f][4][b].slice(5)];5<drawla[f].length&&(c=drawla[f][5])}"a11ydraw"==canvases[f][1].substr(0,8)?ib(canvases[f],
c):Ab(canvases[f][0],"canvas"+canvases[f][0],imasroot+"/filter/graph/imgs/"+canvases[f][1],"qn"+canvases[f][0],canvases[f][2],canvases[f][3],canvases[f][4],canvases[f][5],canvases[f][6],canvases[f][7],canvases[f][8],canvases[f][9],canvases[f][10],canvases[f][11],canvases[f][12])}}function Xa(a){for(var d,c=0;c<t.idnums.length;c++)if("undefined"==typeof a||a==t.idnums[c]){d=t.idnums[c];var b,g=d;var e=document.getElementById("qn"+g).value;if(b=e.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/)){var h=
3;e=b[1];b=b[2]}else(b=e.match(/\(-oo,([\-\d\.]+)\)/))?(h=0,e=b[1],b=2.5):(b=e.match(/\(([\-\d\.]+),oo\)/))?(h=1,e=b[1],b=2.5):(b=e.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(h=2,e=b[1],b=b[2]):(h=0,e=-1.5,b=2.5);document.getElementById("slid1"+g).style.left=60*e+250-6+"px";document.getElementById("slid2"+g).style.left=60*b+250-6+"px";document.getElementById("shaderegions"+g).selectedIndex=h;t.curslider.type=document.getElementById("shaderegions"+g).value;hb(g);v("#slid1"+d).on("touchstart.normslider mousedown.normslider",
Ya);v("#slid2"+d).on("touchstart.normslider mousedown.normslider",Ya)}}function Ya(a){a=a||window.event;a.originalEvent.touches&&0<a.originalEvent.touches.length?(K=!0,v(document).on("touchmove.normslider",Za),v(document).on("touchend.normslider",$a)):(v(document).on("mousemove.normslider",Za),v(document).on("mouseup.normslider",$a));t.curslider.el=a.target||a.srcElement;t.curslider.id=t.curslider.el.id.substring(5);t.curslider.type=document.getElementById("shaderegions"+t.curslider.id).value;t.curslider.outnode=
document.getElementById(t.outputid);t.curslider.startpos=gb(t.curslider.el,a);t.curslider.el.parentNode.style.cursor="pointer";N(t.curslider.el.parentNode);a.preventDefault&&a.preventDefault();return!1}function Za(a){var d=t.curslider.id;a=a||window.event;var c=gb(t.curslider.el.parentNode,a);if(!(5>c.x||c.x>t.curslider.el.parentNode.offsetWidth-5||5>c.y||c.y>t.curslider.el.parentNode.offsetHeight-5))return t.curslider.el.style.left=6*Math.round((c.x-t.curslider.startpos.x-10)/6)+10+"px",ab(d),a.preventDefault&&
a.preventDefault(),!1}function $a(a){null!==t.curslider.el&&(K=!1,v(document).off("touchmove.normslider touchend.normslider"),v(document).off("mousemove.normslider mouseup.normslider"),t.curslider.el.parentNode.style.cursor="",t.curslider.el=null)}function ab(a){var d=parseInt(document.getElementById("slid1"+a).style.left)+6,c=parseInt(document.getElementById("slid2"+a).style.left)+6,b=Math.min(d,c),e=Math.max(d,c);"2O"==t.curslider.type?document.getElementById("normleft"+a).style.width=b+1+"px":
"1L"==t.curslider.type?document.getElementById("normleft"+a).style.width=d+1+"px":"2B"==t.curslider.type&&(document.getElementById("normleft"+a).style.left=b+"px",document.getElementById("normleft"+a).style.width=e-b+1+"px");"2O"==t.curslider.type?document.getElementById("normright"+a).style.width=500-e+"px":"1R"==t.curslider.type&&(document.getElementById("normright"+a).style.width=500-d+"px");b=(-4+(d-10)/60).toFixed(1);e=(-4+(c-10)/60).toFixed(1);var g=document.getElementById("slid1txt"+a);g.innerHTML=
b;g.style.left=d-6+"px";d=document.getElementById("slid2txt"+a);d.innerHTML=e;d.style.left=c-6+"px";c=Math.min(b,e);d=Math.max(b,e);if("2O"==t.curslider.type)var h="(-oo,"+c+")U("+d+",oo)";else"2B"==t.curslider.type?h="("+c+","+d+")":"1L"==t.curslider.type?h="(-oo,"+b+")":"1R"==t.curslider.type&&(h="("+b+",oo)");document.getElementById("qn"+a).value=h}function hb(a){var d=document.getElementById("shaderegions"+a).value;t.curslider.type=d;var c=parseInt(document.getElementById("slid1"+a).style.left)+
6,b=parseInt(document.getElementById("slid2"+a).style.left)+6,e=Math.min(c,b);b=Math.max(c,b);"1R"==d||"1L"==d?(document.getElementById("slid2"+a).style.display="none",document.getElementById("slid2txt"+a).style.display="none","1R"==d?(document.getElementById("normleft"+a).style.display="none",document.getElementById("normright"+a).style.display="",document.getElementById("normright"+a).style.right="0px",document.getElementById("normright"+a).style.width=500-c+"px"):(document.getElementById("normright"+
a).style.display="none",document.getElementById("normleft"+a).style.display="",document.getElementById("normleft"+a).style.left="0px",document.getElementById("normleft"+a).style.width=c+"px")):"2O"==d?(document.getElementById("slid2"+a).style.display="",document.getElementById("slid2txt"+a).style.display="",document.getElementById("normleft"+a).style.display="",document.getElementById("normright"+a).style.display="",document.getElementById("normright"+a).style.right="0px",document.getElementById("normleft"+
a).style.left="0px",document.getElementById("normright"+a).style.width=500-b+"px",document.getElementById("normleft"+a).style.width=e+"px"):"2B"==d&&(document.getElementById("slid2"+a).style.display="",document.getElementById("slid2txt"+a).style.display="",document.getElementById("normleft"+a).style.display="",document.getElementById("normright"+a).style.display="none",document.getElementById("normleft"+a).style.left=e+"px",document.getElementById("normleft"+a).style.width=b-e+"px");ab(a)}var U=!1,
e=[],bb=[],wa=[],Ea=[],n=[],I=[],F=[],d=[],y=[],m=[],M=[],r=null,Na=[],ja=[],x=null,G=null,tb=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],Cb=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],l=null,Ca=null,a=null,sb=!1,K=!1,ha=!1,Da=!1,Wa=null,Va={5:2,"5.2":2,"5.3":2,"5.4":2,6:2,"6.1":2,"6.5":2,7:2,"7.2":2,"7.4":2,"7.5":2,8:2,"8.2":2,"8.3":2,"8.4":2,"8.5":3,"8.6":3,9:2,"9.1":2,10:3,"10.2":3,"10.3":3,"10.4":3},qb={"7.4":1,"7.5":1,"8.2":1,"8.5":1,"8.6":1},Db=0,va=null,V=-1;"undefined"!=
typeof initstack?initstack.push(xa):v(function(){xa()});var t={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}};"undefined"!=typeof initstack&&initstack.push(Xa);return{initCanvases:xa,clearcanvas:function(e){n[e].length=0;I[e].length=0;F[e].length=0;d[e].length=0;y[e].length=0;m[e].length=0;M[e].length=0;a=e;z();l=r=a=null},settool:function(d,f,c){for(var b=document.getElementById("drawtools"+f),g=b.getElementsByTagName("span"),l=0;l<g.length;l++)g[l].className="";g=b.getElementsByTagName("img");
for(l=0;l<g.length;l++)g[l].className="";d.className="sel";e[f].mode=c;a=f;z()},addnormslider:function(a){-1==arraysearch(a,t.idnums)?t.idnums.push(a):Xa(a)},chgnormtype:hb,adda11ydraw:Q,changea11ydraw:function(a,d){var c=v(a).val();c=e[d].moderef[c];v(a).parent().find(".a11ydrawinstr").text(c.input)},encodea11ydraw:function(){for(var a=0;a<Ea.length;a++){var d=Ea[a],c=e[d],b=[],l=[],m=[],h=[],n=[],k=[];v("#a11ydraw"+d).find(".a11ydrawrow").each(function(a,d){var e=v(d).find("select").val(),f=v(d).find("input").val();
k.push("["+e+',"'+f+'"]');f=f.replace(/[\(\)]/g,"").split(/\s*,\s*/);var g=[];for(a=1;a<f.length;a+=2){try{f[a-1]=eval(prepWithMath(mathjs(f[a-1])))}catch(Bb){f[a-1]=NaN}try{f[a]=eval(prepWithMath(mathjs(f[a])))}catch(Bb){f[a]=NaN}f[a-1]=(f[a-1]-c.xmin)*c.pixperx+c.imgborder;f[a]=c.imgheight-(f[a]-c.ymin)*c.pixpery-c.imgborder;g.push(Math.round(f[a-1])+","+Math.round(f[a]))}1==e?l.push("("+g.join("),(")+")"):2==e?m.push("("+g.join("),(")+")"):1>e?b.push("("+g.join("),(")+")"):5<=e&&10>e&&2==g.length?
h.push("("+e+","+g.join(",")+")"):10<=e&&3==g.length&&n.push("("+e+","+g.join(",")+")")});wa[d].value=b.join(";")+";;"+l.join(",")+";;"+m.join(",")+";;"+h.join(",")+";;"+n.join(",")+";;"+k.join(",")}},removea11ydraw:function(a){v(a).parent().remove()}}}(jQuery);

var ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;function showeh(a){if(null==eecurel){unhideeh(0);var c=document.getElementById(a),b=document.getElementById("eh");a!=ehcurel?(ehcurel=a,a=findPos(c),b.style.display="block",b.style.left=a[0]+"px",b.style.top=a[1]+c.offsetHeight+"px"):(b.style.display="none",ehcurel=null);c.focus()}}
function reshrinkeh(a){null==eecurel&&a==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=a,unhideeh(0))}function unhideeh(a){ehcancelclosetimer()}function hideeh(a){null==ehcurel?ehddclosetimer=window.setTimeout(function(){curehdd=null;document.getElementById("ehdd").style.display="none"},250):ehclosetimer=window.setTimeout(reallyhideeh,250)}
function reallyhideeh(){document.getElementById("eh").style.display="none";ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}
function showehdd(a,c,b){if((null==eecurel||eecurel!=a)&&null!=document.getElementById("tips"+b)){ehddclosetimer&&a!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null);if(a!=ehcurel){var d=document.getElementById("ehdd"),e=document.getElementById(a),f=findPos(e);document.getElementById("ehddtext").innerHTML=c;document.getElementById("eh").innerHTML=document.getElementById("tips"+b).innerHTML;d.style.display="block";d.style.left=f[0]+"px";d.style.top=f[1]+e.offsetHeight+"px"}curehdd=
a}}function updateehpos(){if(curehdd||ehcurel){var a=document.getElementById("eh"),c=document.getElementById("ehdd"),b=document.getElementById(curehdd||ehcurel),d=findPos(b);a.style.left=d[0]+"px";a.style.top=d[1]+b.offsetHeight+"px";c.style.left=d[0]+"px";c.style.top=d[1]+b.offsetHeight+"px"}};
